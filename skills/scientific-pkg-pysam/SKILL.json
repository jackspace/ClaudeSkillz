{
  "description": "\"Genomic file toolkit. Read/write SAM/BAM/CRAM alignments, VCF/BCF variants, FASTA/FASTQ sequences, extract regions, calculate coverage, for NGS data processing pipelines.\"",
  "references": {
    "files": [
      "references/alignment_files.md",
      "references/common_workflows.md",
      "references/sequence_files.md",
      "references/variant_files.md"
    ]
  },
  "content": "### Installation\r\n```python\r\n```\r\n\r\n### Basic Examples\r\n\r\n**Read alignment file:**\r\n```python\r\nimport pysam\r\n\r\nsamfile = pysam.AlignmentFile(\"example.bam\", \"rb\")\r\nfor read in samfile.fetch(\"chr1\", 1000, 2000):\r\n    print(f\"{read.query_name}: {read.reference_start}\")\r\nsamfile.close()\r\n```\r\n\r\n**Read variant file:**\r\n```python\r\nvcf = pysam.VariantFile(\"variants.vcf\")\r\nfor variant in vcf:\r\n    print(f\"{variant.chrom}:{variant.pos} {variant.ref}>{variant.alts}\")\r\nvcf.close()\r\n```\r\n\r\n**Query reference sequence:**\r\n```python\r\n\r\nPysam provides access to samtools and bcftools commands:\r\n\r\n```python\r\npysam.samtools.sort(\"-o\", \"sorted.bam\", \"input.bam\")\r\n\r\npysam.samtools.index(\"sorted.bam\")\r\n\r\npysam.samtools.view(\"-b\", \"-o\", \"region.bam\", \"input.bam\", \"chr1:1000-2000\")",
  "name": "pysam",
  "id": "scientific-pkg-pysam",
  "sections": {
    "Quick Start": "fasta = pysam.FastaFile(\"reference.fasta\")\r\nsequence = fasta.fetch(\"chr1\", 1000, 2000)\r\nprint(sequence)\r\nfasta.close()\r\n```",
    "Getting Help": "For detailed information on specific operations, refer to the appropriate reference document:\r\n\r\n- Working with BAM files or calculating coverage → `alignment_files.md`\r\n- Analyzing variants or genotypes → `variant_files.md`\r\n- Extracting sequences or processing FASTQ → `sequence_files.md`\r\n- Complex workflows integrating multiple file types → `common_workflows.md`\r\n\r\nOfficial documentation: https://pysam.readthedocs.io/",
    "Common Pitfalls": "1. **Coordinate confusion:** Remember 0-based vs 1-based systems in different contexts\r\n2. **Missing indices:** Many operations require index files—create them first\r\n3. **Partial overlaps:** `fetch()` returns reads overlapping region boundaries, not just those fully contained\r\n4. **Iterator scope:** Keep pileup iterator references alive to avoid \"PileupProxy accessed after iterator finished\" errors\r\n5. **Quality score editing:** Cannot modify `query_qualities` in place after changing `query_sequence`—create a copy first\r\n6. **Stream limitations:** Only stdin/stdout are supported for streaming, not arbitrary Python file objects\r\n7. **Thread safety:** While GIL is released during I/O, comprehensive thread-safety hasn't been fully validated",
    "Command-Line Tools": "pysam.bcftools.view(\"-O\", \"z\", \"-o\", \"output.vcf.gz\", \"input.vcf\")\r\n```\r\n\r\n**Error handling:**\r\n```python\r\ntry:\r\n    pysam.samtools.sort(\"-o\", \"output.bam\", \"input.bam\")\r\nexcept pysam.SamtoolsError as e:\r\n    print(f\"Error: {e}\")\r\n```",
    "Overview": "Pysam is a Python module for reading, manipulating, and writing genomic datasets. Read/write SAM/BAM/CRAM alignment files, VCF/BCF variant files, and FASTA/FASTQ sequences with a Pythonic interface to htslib. Query tabix-indexed files, perform pileup analysis for coverage, and execute samtools/bcftools commands.",
    "When to Use This Skill": "This skill should be used when:\r\n- Working with sequencing alignment files (BAM/CRAM)\r\n- Analyzing genetic variants (VCF/BCF)\r\n- Extracting reference sequences or gene regions\r\n- Processing raw sequencing data (FASTQ)\r\n- Calculating coverage or read depth\r\n- Implementing bioinformatics analysis pipelines\r\n- Quality control of sequencing data\r\n- Variant calling and annotation workflows",
    "Resources": "### references/\r\n\r\nDetailed documentation for each major capability:\r\n\r\n- **alignment_files.md** - Complete guide to SAM/BAM/CRAM operations, including AlignmentFile class, AlignedSegment attributes, fetch operations, pileup analysis, and writing alignments\r\n\r\n- **variant_files.md** - Complete guide to VCF/BCF operations, including VariantFile class, VariantRecord attributes, genotype handling, INFO/FORMAT fields, and multi-sample operations\r\n\r\n- **sequence_files.md** - Complete guide to FASTA/FASTQ operations, including FastaFile and FastxFile classes, sequence extraction, quality score handling, and tabix-indexed file access\r\n\r\n- **common_workflows.md** - Practical examples of integrated bioinformatics workflows combining multiple file types, including quality control, coverage analysis, variant validation, and sequence extraction",
    "Core Capabilities": "### 1. Alignment File Operations (SAM/BAM/CRAM)\r\n\r\nUse the `AlignmentFile` class to work with aligned sequencing reads. This is appropriate for analyzing mapping results, calculating coverage, extracting reads, or quality control.\r\n\r\n**Common operations:**\r\n- Open and read BAM/SAM/CRAM files\r\n- Fetch reads from specific genomic regions\r\n- Filter reads by mapping quality, flags, or other criteria\r\n- Write filtered or modified alignments\r\n- Calculate coverage statistics\r\n- Perform pileup analysis (base-by-base coverage)\r\n- Access read sequences, quality scores, and alignment information\r\n\r\n**Reference:** See `references/alignment_files.md` for detailed documentation on:\r\n- Opening and reading alignment files\r\n- AlignedSegment attributes and methods\r\n- Region-based fetching with `fetch()`\r\n- Pileup analysis for coverage\r\n- Writing and creating BAM files\r\n- Coordinate systems and indexing\r\n- Performance optimization tips\r\n\r\n### 2. Variant File Operations (VCF/BCF)\r\n\r\nUse the `VariantFile` class to work with genetic variants from variant calling pipelines. This is appropriate for variant analysis, filtering, annotation, or population genetics.\r\n\r\n**Common operations:**\r\n- Read and write VCF/BCF files\r\n- Query variants in specific regions\r\n- Access variant information (position, alleles, quality)\r\n- Extract genotype data for samples\r\n- Filter variants by quality, allele frequency, or other criteria\r\n- Annotate variants with additional information\r\n- Subset samples or regions\r\n\r\n**Reference:** See `references/variant_files.md` for detailed documentation on:\r\n- Opening and reading variant files\r\n- VariantRecord attributes and methods\r\n- Accessing INFO and FORMAT fields\r\n- Working with genotypes and samples\r\n- Creating and writing VCF files\r\n- Filtering and subsetting variants\r\n- Multi-sample VCF operations\r\n\r\n### 3. Sequence File Operations (FASTA/FASTQ)\r\n\r\nUse `FastaFile` for random access to reference sequences and `FastxFile` for reading raw sequencing data. This is appropriate for extracting gene sequences, validating variants against reference, or processing raw reads.\r\n\r\n**Common operations:**\r\n- Query reference sequences by genomic coordinates\r\n- Extract sequences for genes or regions of interest\r\n- Read FASTQ files with quality scores\r\n- Validate variant reference alleles\r\n- Calculate sequence statistics\r\n- Filter reads by quality or length\r\n- Convert between FASTA and FASTQ formats\r\n\r\n**Reference:** See `references/sequence_files.md` for detailed documentation on:\r\n- FASTA file access and indexing\r\n- Extracting sequences by region\r\n- Handling reverse complement for genes\r\n- Reading FASTQ files sequentially\r\n- Quality score conversion and filtering\r\n- Working with tabix-indexed files (BED, GTF, GFF)\r\n- Common sequence processing patterns\r\n\r\n### 4. Integrated Bioinformatics Workflows\r\n\r\nPysam excels at integrating multiple file types for comprehensive genomic analyses. Common workflows combine alignment files, variant files, and reference sequences.\r\n\r\n**Common workflows:**\r\n- Calculate coverage statistics for specific regions\r\n- Validate variants against aligned reads\r\n- Annotate variants with coverage information\r\n- Extract sequences around variant positions\r\n- Filter alignments or variants based on multiple criteria\r\n- Generate coverage tracks for visualization\r\n- Quality control across multiple data types\r\n\r\n**Reference:** See `references/common_workflows.md` for detailed examples of:\r\n- Quality control workflows (BAM statistics, reference consistency)\r\n- Coverage analysis (per-base coverage, low coverage detection)\r\n- Variant analysis (annotation, filtering by read support)\r\n- Sequence extraction (variant contexts, gene sequences)\r\n- Read filtering and subsetting\r\n- Integration patterns (BAM+VCF, VCF+BED, etc.)\r\n- Performance optimization for complex workflows",
    "Key Concepts": "### Coordinate Systems\r\n\r\n**Critical:** Pysam uses **0-based, half-open** coordinates (Python convention):\r\n- Start positions are 0-based (first base is position 0)\r\n- End positions are exclusive (not included in the range)\r\n- Region 1000-2000 includes bases 1000-1999 (1000 bases total)\r\n\r\n**Exception:** Region strings in `fetch()` follow samtools convention (1-based):\r\n```python\r\nsamfile.fetch(\"chr1\", 999, 2000)      # 0-based: positions 999-1999\r\nsamfile.fetch(\"chr1:1000-2000\")       # 1-based string: positions 1000-2000\r\n```\r\n\r\n**VCF files:** Use 1-based coordinates in the file format, but `VariantRecord.start` is 0-based.\r\n\r\n### Indexing Requirements\r\n\r\nRandom access to specific genomic regions requires index files:\r\n- **BAM files**: Require `.bai` index (create with `pysam.index()`)\r\n- **CRAM files**: Require `.crai` index\r\n- **FASTA files**: Require `.fai` index (create with `pysam.faidx()`)\r\n- **VCF.gz files**: Require `.tbi` tabix index (create with `pysam.tabix_index()`)\r\n- **BCF files**: Require `.csi` index\r\n\r\nWithout an index, use `fetch(until_eof=True)` for sequential reading.\r\n\r\n### File Modes\r\n\r\nSpecify format when opening files:\r\n- `\"rb\"` - Read BAM (binary)\r\n- `\"r\"` - Read SAM (text)\r\n- `\"rc\"` - Read CRAM\r\n- `\"wb\"` - Write BAM\r\n- `\"w\"` - Write SAM\r\n- `\"wc\"` - Write CRAM\r\n\r\n### Performance Considerations\r\n\r\n1. **Always use indexed files** for random access operations\r\n2. **Use `pileup()` for column-wise analysis** instead of repeated fetch operations\r\n3. **Use `count()` for counting** instead of iterating and counting manually\r\n4. **Process regions in parallel** when analyzing independent genomic regions\r\n5. **Close files explicitly** to free resources\r\n6. **Use `until_eof=True`** for sequential processing without index\r\n7. **Avoid multiple iterators** unless necessary (use `multiple_iterators=True` if needed)"
  }
}
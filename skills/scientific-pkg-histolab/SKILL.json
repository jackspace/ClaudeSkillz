{
  "description": "Digital pathology image processing toolkit for whole slide images (WSI). Use this skill when working with histopathology slides, processing H&E or IHC stained tissue images, extracting tiles from gigapixel pathology images, detecting tissue regions, segmenting tissue masks, or preparing datasets for computational pathology deep learning pipelines. Applies to WSI formats (SVS, TIFF, NDPI), tile-based analysis, and histological image preprocessing workflows.",
  "references": {
    "files": [
      "references/filters_preprocessing.md",
      "references/slide_management.md",
      "references/tile_extraction.md",
      "references/tissue_masks.md",
      "references/visualization.md"
    ]
  },
  "content": "Install histolab using pip or conda:\r\n\r\n```bash\r\npip install histolab\r\n\r\n\r\nBasic workflow for extracting tiles from a whole slide image:\r\n\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.tiler import RandomTiler\r\n\r\nslide = Slide(\"slide.svs\", processed_path=\"output/\")\r\n\r\ntiler = RandomTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=100,\r\n    level=0,\r\n    seed=42\r\n)\r\n\r\ntiler.locate_tiles(slide, n_tiles=20)\r\n\r\n\r\n### 1. Slide Management\r\n\r\nLoad, inspect, and work with whole slide images in various formats.\r\n\r\n**Common operations:**\r\n- Loading WSI files (SVS, TIFF, NDPI, etc.)\r\n- Accessing slide metadata (dimensions, magnification, properties)\r\n- Generating thumbnails for visualization\r\n- Working with pyramidal image structures\r\n- Extracting regions at specific coordinates\r\n\r\n**Key classes:** `Slide`\r\n\r\n**Reference:** `references/slide_management.md` contains comprehensive documentation on:\r\n- Slide initialization and configuration\r\n- Built-in sample datasets (prostate, ovarian, breast, heart, kidney tissues)\r\n- Accessing slide properties and metadata\r\n- Thumbnail generation and visualization\r\n- Working with pyramid levels\r\n- Multi-slide processing workflows\r\n\r\n**Example workflow:**\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.data import prostate_tissue\r\n\r\nprostate_svs, prostate_path = prostate_tissue()\r\n\r\nslide = Slide(prostate_path, processed_path=\"output/\")\r\n\r\nprint(f\"Dimensions: {slide.dimensions}\")\r\nprint(f\"Levels: {slide.levels}\")\r\nprint(f\"Magnification: {slide.properties.get('openslide.objective-power')}\")\r\n\r\nslide.save_thumbnail()\r\n```\r\n\r\n### 2. Tissue Detection and Masks\r\n\r\nAutomatically identify tissue regions and filter background/artifacts.\r\n\r\n**Common operations:**\r\n- Creating binary tissue masks\r\n- Detecting largest tissue region\r\n- Excluding background and artifacts\r\n- Custom tissue segmentation\r\n- Removing pen annotations\r\n\r\n**Key classes:** `TissueMask`, `BiggestTissueBoxMask`, `BinaryMask`\r\n\r\n**Reference:** `references/tissue_masks.md` contains comprehensive documentation on:\r\n- TissueMask: Segments all tissue regions using automated filters\r\n- BiggestTissueBoxMask: Returns bounding box of largest tissue region (default)\r\n- BinaryMask: Base class for custom mask implementations\r\n- Visualizing masks with `locate_mask()`\r\n- Creating custom rectangular and annotation-exclusion masks\r\n- Mask integration with tile extraction\r\n- Best practices and troubleshooting\r\n\r\n**Example workflow:**\r\n```python\r\nfrom histolab.masks import TissueMask, BiggestTissueBoxMask\r\n\r\ntissue_mask = TissueMask()\r\n\r\nslide.locate_mask(tissue_mask)\r\n\r\nmask_array = tissue_mask(slide)\r\n\r\nbiggest_mask = BiggestTissueBoxMask()\r\n```\r\n\r\n**When to use each mask:**\r\n- `TissueMask`: Multiple tissue sections, comprehensive analysis\r\n- `BiggestTissueBoxMask`: Single main tissue section, exclude artifacts (default)\r\n- Custom `BinaryMask`: Specific ROI, exclude annotations, custom segmentation\r\n\r\n### 3. Tile Extraction\r\n\r\nExtract smaller regions from large WSI using different strategies.\r\n\r\n**Three extraction strategies:**\r\n\r\n**RandomTiler:** Extract fixed number of randomly positioned tiles\r\n- Best for: Sampling diverse regions, exploratory analysis, training data\r\n- Key parameters: `n_tiles`, `seed` for reproducibility\r\n\r\n**GridTiler:** Systematically extract tiles across tissue in grid pattern\r\n- Best for: Complete coverage, spatial analysis, reconstruction\r\n- Key parameters: `pixel_overlap` for sliding windows\r\n\r\n**ScoreTiler:** Extract top-ranked tiles based on scoring functions\r\n- Best for: Most informative regions, quality-driven selection\r\n- Key parameters: `scorer` (NucleiScorer, CellularityScorer, custom)\r\n\r\n**Common parameters:**\r\n- `tile_size`: Tile dimensions (e.g., (512, 512))\r\n- `level`: Pyramid level for extraction (0 = highest resolution)\r\n- `check_tissue`: Filter tiles by tissue content\r\n- `tissue_percent`: Minimum tissue coverage (default 80%)\r\n- `extraction_mask`: Mask defining extraction region\r\n\r\n**Reference:** `references/tile_extraction.md` contains comprehensive documentation on:\r\n- Detailed explanation of each tiler strategy\r\n- Available scorers (NucleiScorer, CellularityScorer, custom)\r\n- Tile preview with `locate_tiles()`\r\n- Extraction workflows and reporting\r\n- Advanced patterns (multi-level, hierarchical extraction)\r\n- Performance optimization and troubleshooting\r\n\r\n**Example workflows:**\r\n\r\n```python\r\nfrom histolab.tiler import RandomTiler, GridTiler, ScoreTiler\r\nfrom histolab.scorer import NucleiScorer\r\n\r\nrandom_tiler = RandomTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=100,\r\n    level=0,\r\n    seed=42,\r\n    check_tissue=True,\r\n    tissue_percent=80.0\r\n)\r\nrandom_tiler.extract(slide)\r\n\r\ngrid_tiler = GridTiler(\r\n    tile_size=(512, 512),\r\n    level=0,\r\n    pixel_overlap=0,\r\n    check_tissue=True\r\n)\r\ngrid_tiler.extract(slide)\r\n\r\nscore_tiler = ScoreTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=50,\r\n    scorer=NucleiScorer(),\r\n    level=0\r\n)\r\nscore_tiler.extract(slide, report_path=\"tiles_report.csv\")\r\n```\r\n\r\n**Always preview before extracting:**\r\n```python\r\ntiler.locate_tiles(slide, n_tiles=20)\r\n```\r\n\r\n### 4. Filters and Preprocessing\r\n\r\nApply image processing filters for tissue detection, quality control, and preprocessing.\r\n\r\n**Filter categories:**\r\n\r\n**Image Filters:** Color space conversions, thresholding, contrast enhancement\r\n- `RgbToGrayscale`, `RgbToHsv`, `RgbToHed`\r\n- `OtsuThreshold`, `AdaptiveThreshold`\r\n- `StretchContrast`, `HistogramEqualization`\r\n\r\n**Morphological Filters:** Structural operations on binary images\r\n- `BinaryDilation`, `BinaryErosion`\r\n- `BinaryOpening`, `BinaryClosing`\r\n- `RemoveSmallObjects`, `RemoveSmallHoles`\r\n\r\n**Composition:** Chain multiple filters together\r\n- `Compose`: Create filter pipelines\r\n\r\n**Reference:** `references/filters_preprocessing.md` contains comprehensive documentation on:\r\n- Detailed explanation of each filter type\r\n- Filter composition and chaining\r\n- Common preprocessing pipelines (tissue detection, pen removal, nuclei enhancement)\r\n- Applying filters to tiles\r\n- Custom mask filters\r\n- Quality control filters (blur detection, tissue coverage)\r\n- Best practices and troubleshooting\r\n\r\n**Example workflows:**\r\n\r\n```python\r\nfrom histolab.filters.compositions import Compose\r\nfrom histolab.filters.image_filters import RgbToGrayscale, OtsuThreshold\r\nfrom histolab.filters.morphological_filters import (\r\n    BinaryDilation, RemoveSmallHoles, RemoveSmallObjects\r\n)\r\n\r\ntissue_detection = Compose([\r\n    RgbToGrayscale(),\r\n    OtsuThreshold(),\r\n    BinaryDilation(disk_size=5),\r\n    RemoveSmallHoles(area_threshold=1000),\r\n    RemoveSmallObjects(area_threshold=500)\r\n])\r\n\r\nfrom histolab.masks import TissueMask\r\ncustom_mask = TissueMask(filters=tissue_detection)\r\n\r\nfrom histolab.tile import Tile\r\nfiltered_tile = tile.apply_filters(tissue_detection)\r\n```\r\n\r\n### 5. Visualization\r\n\r\nVisualize slides, masks, tile locations, and extraction quality.\r\n\r\n**Common visualization tasks:**\r\n- Displaying slide thumbnails\r\n- Visualizing tissue masks\r\n- Previewing tile locations\r\n- Assessing tile quality\r\n- Creating reports and figures\r\n\r\n**Reference:** `references/visualization.md` contains comprehensive documentation on:\r\n- Slide thumbnail display and saving\r\n- Mask visualization with `locate_mask()`\r\n- Tile location preview with `locate_tiles()`\r\n- Displaying extracted tiles and mosaics\r\n- Quality assessment (score distributions, top vs bottom tiles)\r\n- Multi-slide visualization\r\n- Filter effect visualization\r\n- Exporting high-resolution figures and PDF reports\r\n- Interactive visualization in Jupyter notebooks\r\n\r\n**Example workflows:**\r\n\r\n```python\r\nimport matplotlib.pyplot as plt\r\nfrom histolab.masks import TissueMask\r\n\r\nplt.figure(figsize=(10, 10))\r\nplt.imshow(slide.thumbnail)\r\nplt.title(f\"Slide: {slide.name}\")\r\nplt.axis('off')\r\nplt.show()\r\n\r\ntissue_mask = TissueMask()\r\nslide.locate_mask(tissue_mask)\r\n\r\ntiler = RandomTiler(tile_size=(512, 512), n_tiles=50)\r\ntiler.locate_tiles(slide, n_tiles=20)\r\n\r\n\r\n### Workflow 1: Exploratory Tile Extraction\r\n\r\nQuick sampling of diverse tissue regions for initial analysis.\r\n\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.tiler import RandomTiler\r\nimport logging\r\n\r\nlogging.basicConfig(level=logging.INFO)\r\n\r\nslide = Slide(\"slide.svs\", processed_path=\"output/random_tiles/\")\r\n\r\nprint(f\"Dimensions: {slide.dimensions}\")\r\nprint(f\"Levels: {slide.levels}\")\r\nslide.save_thumbnail()\r\n\r\nrandom_tiler = RandomTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=100,\r\n    level=0,\r\n    seed=42,\r\n    check_tissue=True,\r\n    tissue_percent=80.0\r\n)\r\n\r\nrandom_tiler.locate_tiles(slide, n_tiles=20)\r\n\r\nrandom_tiler.extract(slide)\r\n```\r\n\r\n### Workflow 2: Comprehensive Grid Extraction\r\n\r\nComplete tissue coverage for whole-slide analysis.\r\n\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.tiler import GridTiler\r\nfrom histolab.masks import TissueMask\r\n\r\nslide = Slide(\"slide.svs\", processed_path=\"output/grid_tiles/\")\r\n\r\ntissue_mask = TissueMask()\r\nslide.locate_mask(tissue_mask)\r\n\r\ngrid_tiler = GridTiler(\r\n    tile_size=(512, 512),\r\n    level=1,  # Use level 1 for faster extraction\r\n    pixel_overlap=0,\r\n    check_tissue=True,\r\n    tissue_percent=70.0\r\n)\r\n\r\ngrid_tiler.locate_tiles(slide)\r\n\r\ngrid_tiler.extract(slide, extraction_mask=tissue_mask)\r\n```\r\n\r\n### Workflow 3: Quality-Driven Tile Selection\r\n\r\nExtract most informative tiles based on nuclei density.\r\n\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.tiler import ScoreTiler\r\nfrom histolab.scorer import NucleiScorer\r\nimport pandas as pd\r\nimport matplotlib.pyplot as plt\r\n\r\nslide = Slide(\"slide.svs\", processed_path=\"output/scored_tiles/\")\r\n\r\nscore_tiler = ScoreTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=50,\r\n    level=0,\r\n    scorer=NucleiScorer(),\r\n    check_tissue=True\r\n)\r\n\r\nscore_tiler.locate_tiles(slide, n_tiles=15)\r\n\r\nscore_tiler.extract(slide, report_path=\"tiles_report.csv\")\r\n\r\nreport_df = pd.read_csv(\"tiles_report.csv\")\r\nplt.hist(report_df['score'], bins=20, edgecolor='black')\r\nplt.xlabel('Tile Score')\r\nplt.ylabel('Frequency')\r\nplt.title('Distribution of Tile Scores')\r\nplt.show()\r\n```\r\n\r\n### Workflow 4: Multi-Slide Processing Pipeline\r\n\r\nProcess entire slide collection with consistent parameters.\r\n\r\n```python\r\nfrom pathlib import Path\r\nfrom histolab.slide import Slide\r\nfrom histolab.tiler import RandomTiler\r\nimport logging\r\n\r\nlogging.basicConfig(level=logging.INFO)\r\n\r\ntiler = RandomTiler(\r\n    tile_size=(512, 512),\r\n    n_tiles=50,\r\n    level=0,\r\n    seed=42,\r\n    check_tissue=True\r\n)\r\n\r\nslide_dir = Path(\"slides/\")\r\noutput_base = Path(\"output/\")\r\n\r\nfor slide_path in slide_dir.glob(\"*.svs\"):\r\n    print(f\"\\nProcessing: {slide_path.name}\")\r\n\r\n    # Create slide-specific output directory\r\n    output_dir = output_base / slide_path.stem\r\n    output_dir.mkdir(parents=True, exist_ok=True)\r\n\r\n    # Load and process slide\r\n    slide = Slide(slide_path, processed_path=output_dir)\r\n\r\n    # Save thumbnail for review\r\n    slide.save_thumbnail()\r\n\r\n    # Extract tiles\r\n    tiler.extract(slide)\r\n\r\n    print(f\"Completed: {slide_path.name}\")\r\n```\r\n\r\n### Workflow 5: Custom Tissue Detection and Filtering\r\n\r\nHandle slides with artifacts, annotations, or unusual staining.\r\n\r\n```python\r\nfrom histolab.slide import Slide\r\nfrom histolab.masks import TissueMask\r\nfrom histolab.tiler import RandomTiler\r\nfrom histolab.filters.compositions import Compose\r\nfrom histolab.filters.image_filters import RgbToGrayscale, OtsuThreshold\r\nfrom histolab.filters.morphological_filters import (\r\n    BinaryDilation, RemoveSmallObjects, RemoveSmallHoles\r\n)\r\n\r\naggressive_filters = Compose([\r\n    RgbToGrayscale(),\r\n    OtsuThreshold(),\r\n    BinaryDilation(disk_size=10),\r\n    RemoveSmallHoles(area_threshold=5000),\r\n    RemoveSmallObjects(area_threshold=3000)  # Remove larger artifacts\r\n])\r\n\r\ncustom_mask = TissueMask(filters=aggressive_filters)\r\n\r\nslide = Slide(\"slide.svs\", processed_path=\"output/\")\r\nslide.locate_mask(custom_mask)",
  "name": "histolab",
  "id": "scientific-pkg-histolab",
  "sections": {
    "Quick Start": "tiler.extract(slide)\r\n```",
    "Best Practices": "### Slide Loading and Inspection\r\n1. Always inspect slide properties before processing\r\n2. Save thumbnails for quick visual review\r\n3. Check pyramid levels and dimensions\r\n4. Verify tissue is present using thumbnails\r\n\r\n### Tissue Detection\r\n1. Preview masks with `locate_mask()` before extraction\r\n2. Use `TissueMask` for multiple sections, `BiggestTissueBoxMask` for single sections\r\n3. Customize filters for specific stains (H&E vs IHC)\r\n4. Handle pen annotations with custom masks\r\n5. Test masks on diverse slides\r\n\r\n### Tile Extraction\r\n1. **Always preview with `locate_tiles()` before extracting**\r\n2. Choose appropriate tiler:\r\n   - RandomTiler: Sampling and exploration\r\n   - GridTiler: Complete coverage\r\n   - ScoreTiler: Quality-driven selection\r\n3. Set appropriate `tissue_percent` threshold (70-90% typical)\r\n4. Use seeds for reproducibility in RandomTiler\r\n5. Extract at appropriate pyramid level for analysis resolution\r\n6. Enable logging for large datasets\r\n\r\n### Performance\r\n1. Extract at lower levels (1, 2) for faster processing\r\n2. Use `BiggestTissueBoxMask` over `TissueMask` when appropriate\r\n3. Adjust `tissue_percent` to reduce invalid tile attempts\r\n4. Limit `n_tiles` for initial exploration\r\n5. Use `pixel_overlap=0` for non-overlapping grids\r\n\r\n### Quality Control\r\n1. Validate tile quality (check for blur, artifacts, focus)\r\n2. Review score distributions for ScoreTiler\r\n3. Inspect top and bottom scoring tiles\r\n4. Monitor tissue coverage statistics\r\n5. Filter extracted tiles by additional quality metrics if needed",
    "Installation": "conda install -c conda-forge histolab\r\n```",
    "Troubleshooting": "### No tiles extracted\r\n- Lower `tissue_percent` threshold\r\n- Verify slide contains tissue (check thumbnail)\r\n- Ensure extraction_mask captures tissue regions\r\n- Check tile_size is appropriate for slide resolution\r\n\r\n### Many background tiles\r\n- Enable `check_tissue=True`\r\n- Increase `tissue_percent` threshold\r\n- Use appropriate mask (TissueMask vs BiggestTissueBoxMask)\r\n- Customize mask filters to better detect tissue\r\n\r\n### Extraction very slow\r\n- Extract at lower pyramid level (level=1 or 2)\r\n- Reduce `n_tiles` for RandomTiler/ScoreTiler\r\n- Use RandomTiler instead of GridTiler for sampling\r\n- Use BiggestTissueBoxMask instead of TissueMask\r\n\r\n### Tiles have artifacts\r\n- Implement custom annotation-exclusion masks\r\n- Adjust filter parameters for artifact removal\r\n- Increase small object removal threshold\r\n- Apply post-extraction quality filtering\r\n\r\n### Inconsistent results across slides\r\n- Use same seed for RandomTiler\r\n- Normalize staining with preprocessing filters\r\n- Adjust `tissue_percent` per staining quality\r\n- Implement slide-specific mask customization",
    "Overview": "Histolab is a Python library for processing whole slide images (WSI) in digital pathology. It automates tissue detection, extracts informative tiles from gigapixel images, and prepares datasets for deep learning pipelines. The library handles multiple WSI formats, implements sophisticated tissue segmentation, and provides flexible tile extraction strategies.",
    "Typical Workflows": "tiler = RandomTiler(tile_size=(512, 512), n_tiles=100)\r\ntiler.extract(slide, extraction_mask=custom_mask)\r\n```",
    "Common Use Cases": "### Training Deep Learning Models\r\n- Extract balanced datasets using RandomTiler across multiple slides\r\n- Use ScoreTiler with NucleiScorer to focus on cell-rich regions\r\n- Extract at consistent resolution (level 0 or level 1)\r\n- Generate CSV reports for tracking tile metadata\r\n\r\n### Whole Slide Analysis\r\n- Use GridTiler for complete tissue coverage\r\n- Extract at multiple pyramid levels for hierarchical analysis\r\n- Maintain spatial relationships with grid positions\r\n- Use `pixel_overlap` for sliding window approaches\r\n\r\n### Tissue Characterization\r\n- Sample diverse regions with RandomTiler\r\n- Quantify tissue coverage with masks\r\n- Extract stain-specific information with HED decomposition\r\n- Compare tissue patterns across slides\r\n\r\n### Quality Assessment\r\n- Identify optimal focus regions with ScoreTiler\r\n- Detect artifacts using custom masks and filters\r\n- Assess staining quality across slide collection\r\n- Flag problematic slides for manual review\r\n\r\n### Dataset Curation\r\n- Use ScoreTiler to prioritize informative tiles\r\n- Filter tiles by tissue percentage\r\n- Generate reports with tile scores and metadata\r\n- Create stratified datasets across slides and tissue types",
    "Core Capabilities": "from pathlib import Path\r\nfrom PIL import Image\r\n\r\ntile_paths = list(Path(\"output/tiles/\").glob(\"*.png\"))[:16]\r\nfig, axes = plt.subplots(4, 4, figsize=(12, 12))\r\naxes = axes.ravel()\r\n\r\nfor idx, tile_path in enumerate(tile_paths):\r\n    tile_img = Image.open(tile_path)\r\n    axes[idx].imshow(tile_img)\r\n    axes[idx].set_title(tile_path.stem, fontsize=8)\r\n    axes[idx].axis('off')\r\n\r\nplt.tight_layout()\r\nplt.show()\r\n```",
    "Resources": "This skill includes detailed reference documentation in the `references/` directory:\r\n\r\n### references/slide_management.md\r\nComprehensive guide to loading, inspecting, and working with whole slide images:\r\n- Slide initialization and configuration\r\n- Built-in sample datasets\r\n- Slide properties and metadata\r\n- Thumbnail generation and visualization\r\n- Working with pyramid levels\r\n- Multi-slide processing workflows\r\n- Best practices and common patterns\r\n\r\n### references/tissue_masks.md\r\nComplete documentation on tissue detection and masking:\r\n- TissueMask, BiggestTissueBoxMask, BinaryMask classes\r\n- How tissue detection filters work\r\n- Customizing masks with filter chains\r\n- Visualizing masks\r\n- Creating custom rectangular and annotation-exclusion masks\r\n- Integration with tile extraction\r\n- Best practices and troubleshooting\r\n\r\n### references/tile_extraction.md\r\nDetailed explanation of tile extraction strategies:\r\n- RandomTiler, GridTiler, ScoreTiler comparison\r\n- Available scorers (NucleiScorer, CellularityScorer, custom)\r\n- Common and strategy-specific parameters\r\n- Tile preview with locate_tiles()\r\n- Extraction workflows and CSV reporting\r\n- Advanced patterns (multi-level, hierarchical)\r\n- Performance optimization\r\n- Troubleshooting common issues\r\n\r\n### references/filters_preprocessing.md\r\nComplete filter reference and preprocessing guide:\r\n- Image filters (color conversion, thresholding, contrast)\r\n- Morphological filters (dilation, erosion, opening, closing)\r\n- Filter composition and chaining\r\n- Common preprocessing pipelines\r\n- Applying filters to tiles\r\n- Custom mask filters\r\n- Quality control filters\r\n- Best practices and troubleshooting\r\n\r\n### references/visualization.md\r\nComprehensive visualization guide:\r\n- Slide thumbnail display and saving\r\n- Mask visualization techniques\r\n- Tile location preview\r\n- Displaying extracted tiles and creating mosaics\r\n- Quality assessment visualizations\r\n- Multi-slide comparison\r\n- Filter effect visualization\r\n- Exporting high-resolution figures and PDFs\r\n- Interactive visualization in Jupyter notebooks\r\n\r\n**Usage pattern:** Reference files contain in-depth information to support workflows described in this main skill document. Load specific reference files as needed for detailed implementation guidance, troubleshooting, or advanced features."
  }
}
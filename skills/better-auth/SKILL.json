{
  "description": "|",
  "metadata": {
    "license": "MIT"
  },
  "content": "### Core Package\r\n\r\n```bash\r\nnpm install better-auth\r\npnpm add better-auth\r\n\r\n### Pattern 1: Cloudflare Workers + D1\r\n\r\n**Use when**: Building API on Cloudflare Workers with D1 database\r\n\r\n**File**: `src/worker.ts`\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { d1Adapter } from 'better-auth/adapters/d1'\r\nimport { Hono } from 'hono'\r\n\r\ntype Env = {\r\n  DB: D1Database\r\n  BETTER_AUTH_SECRET: string\r\n  GOOGLE_CLIENT_ID: string\r\n  GOOGLE_CLIENT_SECRET: string\r\n}\r\n\r\nconst app = new Hono<{ Bindings: Env }>()\r\n\r\n// Auth routes handler\r\napp.all('/api/auth/*', async (c) => {\r\n  const auth = betterAuth({\r\n    database: d1Adapter(c.env.DB),\r\n    secret: c.env.BETTER_AUTH_SECRET,\r\n\r\n    // Basic auth methods\r\n    emailAndPassword: {\r\n      enabled: true,\r\n      requireEmailVerification: true\r\n    },\r\n\r\n    // Social providers\r\n    socialProviders: {\r\n      google: {\r\n        clientId: c.env.GOOGLE_CLIENT_ID,\r\n        clientSecret: c.env.GOOGLE_CLIENT_SECRET\r\n      }\r\n    }\r\n  })\r\n\r\n  return auth.handler(c.req.raw)\r\n})\r\n\r\nexport default app\r\n```\r\n\r\n**wrangler.toml**:\r\n```toml\r\nname = \"my-app\"\r\nmain = \"src/worker.ts\"\r\ncompatibility_date = \"2024-01-01\"\r\n\r\n[[d1_databases]]\r\nbinding = \"DB\"\r\ndatabase_name = \"my-app-db\"\r\ndatabase_id = \"your-database-id\"\r\n\r\n[vars]\r\n\r\n```\r\n\r\n**Setup D1 Database**:\r\n```bash\r\nwrangler d1 create my-app-db\r\n\r\nnpx better-auth migrate --database d1\r\n\r\n\r\n### D1 Schema Migration\r\n\r\n```bash\r\nnpx better-auth migrate --database d1\r\n\r\n```\r\n\r\n**Apply migration**:\r\n```bash\r\nwrangler d1 execute my-app-db --local --file migrations/0001_initial.sql",
  "name": "better-auth",
  "id": "better-auth",
  "sections": {
    "Version Compatibility": "**Tested with**:\r\n- `better-auth@1.3.34`\r\n- `@cloudflare/workers-types@latest`\r\n- `drizzle-orm@0.30.0`\r\n- `hono@4.0.0`\r\n- Node.js 18+, Bun 1.0+\r\n\r\n**Breaking changes**: Check changelog when upgrading: https://github.com/better-auth/better-auth/releases\r\n\r\n---\r\n\r\n**Last verified**: 2025-10-31 | **Skill version**: 1.0.0",
    "Quick Start Patterns": "wrangler d1 execute my-app-db --remote --file migrations/0001_initial.sql\r\n```\r\n\r\n---\r\n\r\n### Pattern 2: Next.js API Route\r\n\r\n**Use when**: Building traditional Next.js app with PostgreSQL or D1\r\n\r\n**File**: `src/lib/auth.ts`\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { Pool } from 'pg'\r\n\r\nexport const auth = betterAuth({\r\n  database: new Pool({\r\n    connectionString: process.env.DATABASE_URL\r\n  }),\r\n\r\n  secret: process.env.BETTER_AUTH_SECRET!,\r\n\r\n  emailAndPassword: {\r\n    enabled: true,\r\n    requireEmailVerification: true,\r\n    sendVerificationEmail: async ({ user, url }) => {\r\n      // Send email with verification link\r\n      await sendEmail({\r\n        to: user.email,\r\n        subject: 'Verify your email',\r\n        html: `Click <a href=\"${url}\">here</a> to verify`\r\n      })\r\n    }\r\n  },\r\n\r\n  socialProviders: {\r\n    google: {\r\n      clientId: process.env.GOOGLE_CLIENT_ID!,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!\r\n    },\r\n    github: {\r\n      clientId: process.env.GITHUB_CLIENT_ID!,\r\n      clientSecret: process.env.GITHUB_CLIENT_SECRET!\r\n    }\r\n  },\r\n\r\n  // Advanced features via plugins\r\n  plugins: [\r\n    twoFactor(),\r\n    organization(),\r\n    rateLimit()\r\n  ]\r\n})\r\n```\r\n\r\n**File**: `src/app/api/auth/[...all]/route.ts`\r\n```typescript\r\nimport { auth } from '@/lib/auth'\r\n\r\nexport const GET = auth.handler\r\nexport const POST = auth.handler\r\n```\r\n\r\n---\r\n\r\n### Pattern 3: React Client Integration\r\n\r\n**Use when**: Need client-side auth state and actions\r\n\r\n**File**: `src/lib/auth-client.ts`\r\n```typescript\r\nimport { createAuthClient } from 'better-auth/client'\r\n\r\nexport const authClient = createAuthClient({\r\n  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'\r\n})\r\n```\r\n\r\n**File**: `src/components/LoginForm.tsx`\r\n```typescript\r\n'use client'\r\n\r\nimport { authClient } from '@/lib/auth-client'\r\nimport { useState } from 'react'\r\n\r\nexport function LoginForm() {\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    const { data, error } = await authClient.signIn.email({\r\n      email,\r\n      password\r\n    })\r\n\r\n    if (error) {\r\n      console.error('Login failed:', error)\r\n      return\r\n    }\r\n\r\n    // Redirect or update UI\r\n    window.location.href = '/dashboard'\r\n  }\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    await authClient.signIn.social({\r\n      provider: 'google',\r\n      callbackURL: '/dashboard'\r\n    })\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <input\r\n        type=\"email\"\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        placeholder=\"Email\"\r\n      />\r\n      <input\r\n        type=\"password\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        placeholder=\"Password\"\r\n      />\r\n      <button type=\"submit\">Sign In</button>\r\n      <button type=\"button\" onClick={handleGoogleSignIn}>\r\n        Sign in with Google\r\n      </button>\r\n    </form>\r\n  )\r\n}\r\n```\r\n\r\n**Use React Hook** (if you have a session endpoint):\r\n```typescript\r\n'use client'\r\n\r\nimport { useSession } from 'better-auth/client'\r\n\r\nexport function UserProfile() {\r\n  const { data: session, isPending } = useSession()\r\n\r\n  if (isPending) return <div>Loading...</div>\r\n  if (!session) return <div>Not authenticated</div>\r\n\r\n  return (\r\n    <div>\r\n      <p>Welcome, {session.user.email}</p>\r\n      <button onClick={() => authClient.signOut()}>\r\n        Sign Out\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n```\r\n\r\n---\r\n\r\n### Pattern 4: Protected API Route (Middleware)\r\n\r\n**Use when**: Need to verify session in API routes\r\n\r\n**Cloudflare Workers**:\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { d1Adapter } from 'better-auth/adapters/d1'\r\n\r\napp.get('/api/protected', async (c) => {\r\n  const auth = betterAuth({\r\n    database: d1Adapter(c.env.DB),\r\n    secret: c.env.BETTER_AUTH_SECRET\r\n  })\r\n\r\n  const session = await auth.getSession(c.req.raw)\r\n\r\n  if (!session) {\r\n    return c.json({ error: 'Unauthorized' }, 401)\r\n  }\r\n\r\n  return c.json({\r\n    message: 'Protected data',\r\n    user: session.user\r\n  })\r\n})\r\n```\r\n\r\n**Next.js Middleware**:\r\n```typescript\r\n// middleware.ts\r\nimport { NextRequest, NextResponse } from 'next/server'\r\nimport { auth } from '@/lib/auth'\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const session = await auth.getSession(request)\r\n\r\n  if (!session && request.nextUrl.pathname.startsWith('/dashboard')) {\r\n    return NextResponse.redirect(new URL('/login', request.url))\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n  matcher: ['/dashboard/:path*']\r\n}\r\n```\r\n\r\n---",
    "Additional Resources": "- **Official Docs**: https://better-auth.com\r\n- **GitHub**: https://github.com/better-auth/better-auth\r\n- **Examples**: https://github.com/better-auth/better-auth/tree/main/examples\r\n- **Discord**: https://discord.gg/better-auth\r\n- **Migration Guides**: https://better-auth.com/docs/migrations\r\n\r\n---",
    "Migration Guides": "### From Clerk\r\n\r\n**Key differences**:\r\n- Clerk: Third-party service → better-auth: Self-hosted\r\n- Clerk: Proprietary → better-auth: Open source\r\n- Clerk: Monthly cost → better-auth: Free\r\n\r\n**Migration steps**:\r\n\r\n1. **Export user data** from Clerk (CSV or API)\r\n2. **Import into better-auth database**:\r\n   ```typescript\r\n   // migration script\r\n   const clerkUsers = await fetchClerkUsers()\r\n\r\n   for (const clerkUser of clerkUsers) {\r\n     await db.insert(users).values({\r\n       id: clerkUser.id,\r\n       email: clerkUser.email,\r\n       emailVerified: clerkUser.email_verified,\r\n       name: clerkUser.first_name + ' ' + clerkUser.last_name,\r\n       image: clerkUser.profile_image_url\r\n     })\r\n   }\r\n   ```\r\n3. **Replace Clerk SDK** with better-auth client:\r\n   ```typescript\r\n   // Before (Clerk)\r\n   import { useUser } from '@clerk/nextjs'\r\n   const { user } = useUser()\r\n\r\n   // After (better-auth)\r\n   import { useSession } from 'better-auth/client'\r\n   const { data: session } = useSession()\r\n   const user = session?.user\r\n   ```\r\n4. **Update middleware** for session verification\r\n5. **Configure social providers** (same OAuth apps, different config)\r\n\r\n---\r\n\r\n### From Auth.js (NextAuth)\r\n\r\n**Key differences**:\r\n- Auth.js: Limited features → better-auth: Comprehensive (2FA, orgs, etc.)\r\n- Auth.js: Callbacks-heavy → better-auth: Plugin-based\r\n- Auth.js: Session handling varies → better-auth: Consistent\r\n\r\n**Migration steps**:\r\n\r\n1. **Database schema**: Auth.js and better-auth use similar schemas, but column names differ\r\n   ```sql\r\n   -- Map Auth.js to better-auth\r\n   ALTER TABLE users RENAME COLUMN emailVerified TO email_verified;\r\n   -- etc.\r\n   ```\r\n2. **Replace configuration**:\r\n   ```typescript\r\n   // Before (Auth.js)\r\n   import NextAuth from 'next-auth'\r\n   import GoogleProvider from 'next-auth/providers/google'\r\n\r\n   export default NextAuth({\r\n     providers: [GoogleProvider({ /* ... */ })]\r\n   })\r\n\r\n   // After (better-auth)\r\n   import { betterAuth } from 'better-auth'\r\n\r\n   export const auth = betterAuth({\r\n     socialProviders: {\r\n       google: { /* ... */ }\r\n     }\r\n   })\r\n   ```\r\n3. **Update client hooks**:\r\n   ```typescript\r\n   // Before\r\n   import { useSession } from 'next-auth/react'\r\n\r\n   // After\r\n   import { useSession } from 'better-auth/client'\r\n   ```\r\n\r\n---",
    "Advanced Features": "### Two-Factor Authentication (2FA)\r\n\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { twoFactor } from 'better-auth/plugins'\r\n\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  plugins: [\r\n    twoFactor({\r\n      methods: ['totp', 'sms'], // Time-based or SMS\r\n      issuer: 'MyApp'\r\n    })\r\n  ]\r\n})\r\n```\r\n\r\n**Client**:\r\n```typescript\r\n// Enable 2FA for user\r\nconst { data, error } = await authClient.twoFactor.enable({\r\n  method: 'totp'\r\n})\r\n\r\n// Verify code\r\nawait authClient.twoFactor.verify({\r\n  code: '123456'\r\n})\r\n```\r\n\r\n---\r\n\r\n### Organizations & Teams\r\n\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { organization } from 'better-auth/plugins'\r\n\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  plugins: [\r\n    organization({\r\n      roles: ['owner', 'admin', 'member'],\r\n      permissions: {\r\n        admin: ['read', 'write', 'delete'],\r\n        member: ['read']\r\n      }\r\n    })\r\n  ]\r\n})\r\n```\r\n\r\n**Client**:\r\n```typescript\r\n// Create organization\r\nawait authClient.organization.create({\r\n  name: 'Acme Corp',\r\n  slug: 'acme'\r\n})\r\n\r\n// Invite member\r\nawait authClient.organization.inviteMember({\r\n  organizationId: 'org_123',\r\n  email: 'user@example.com',\r\n  role: 'member'\r\n})\r\n\r\n// Check permissions\r\nconst canDelete = await authClient.organization.hasPermission({\r\n  organizationId: 'org_123',\r\n  permission: 'delete'\r\n})\r\n```\r\n\r\n---\r\n\r\n### Multi-Tenant SaaS\r\n\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { multiTenant } from 'better-auth/plugins'\r\n\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  plugins: [\r\n    multiTenant({\r\n      tenantIdHeader: 'x-tenant-id',\r\n      isolateData: true // Ensure tenant data isolation\r\n    })\r\n  ]\r\n})\r\n```\r\n\r\n---\r\n\r\n### Rate Limiting\r\n\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\nimport { rateLimit } from 'better-auth/plugins'\r\n\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  plugins: [\r\n    rateLimit({\r\n      window: 60, // 60 seconds\r\n      max: 5, // 5 requests per window\r\n      storage: 'database' // or 'memory'\r\n    })\r\n  ]\r\n})\r\n```\r\n\r\n**For Cloudflare**: Use KV for distributed rate limiting:\r\n```typescript\r\nimport { rateLimit } from 'better-auth/plugins'\r\n\r\nplugins: [\r\n  rateLimit({\r\n    window: 60,\r\n    max: 5,\r\n    storage: {\r\n      get: async (key) => {\r\n        return await c.env.RATE_LIMIT_KV.get(key)\r\n      },\r\n      set: async (key, value, ttl) => {\r\n        await c.env.RATE_LIMIT_KV.put(key, value, { expirationTtl: ttl })\r\n      }\r\n    }\r\n  })\r\n]\r\n```\r\n\r\n---",
    "Best Practices": "### Security\r\n\r\n1. **Always use HTTPS** in production (no exceptions)\r\n2. **Rotate secrets** regularly:\r\n   ```bash\r\n   # Generate new secret\r\n   openssl rand -base64 32\r\n\r\n   # Update in Wrangler\r\n   wrangler secret put BETTER_AUTH_SECRET\r\n   ```\r\n3. **Validate email domains** for sign-up:\r\n   ```typescript\r\n   emailAndPassword: {\r\n     enabled: true,\r\n     validate: async (email) => {\r\n       const blockedDomains = ['tempmail.com', 'guerrillamail.com']\r\n       const domain = email.split('@')[1]\r\n       if (blockedDomains.includes(domain)) {\r\n         throw new Error('Email domain not allowed')\r\n       }\r\n     }\r\n   }\r\n   ```\r\n4. **Enable CSRF protection** (enabled by default in better-auth)\r\n5. **Use rate limiting** for auth endpoints\r\n6. **Log auth events** for security monitoring:\r\n   ```typescript\r\n   onSuccess: async (user, action) => {\r\n     await logAuthEvent({\r\n       userId: user.id,\r\n       action, // 'sign-in', 'sign-up', 'password-change'\r\n       timestamp: new Date(),\r\n       ipAddress: req.headers.get('cf-connecting-ip')\r\n     })\r\n   }\r\n   ```\r\n\r\n---\r\n\r\n### Performance\r\n\r\n1. **Cache session lookups** (use KV for Workers):\r\n   ```typescript\r\n   const session = await env.SESSIONS_KV.get(sessionId)\r\n   if (session) return JSON.parse(session)\r\n\r\n   // Fallback to DB if not in cache\r\n   const dbSession = await db.query.sessions.findFirst(/* ... */)\r\n   await env.SESSIONS_KV.put(sessionId, JSON.stringify(dbSession))\r\n   ```\r\n\r\n2. **Use indexes** on frequently queried fields:\r\n   ```sql\r\n   CREATE INDEX idx_sessions_user_id ON sessions(userId);\r\n   CREATE INDEX idx_accounts_provider ON accounts(provider, providerAccountId);\r\n   ```\r\n\r\n3. **Minimize session data** (only essential fields)\r\n\r\n4. **Use CDN** for auth endpoints (cache public routes):\r\n   ```typescript\r\n   // Cache GET /api/auth/session for 5 minutes\r\n   c.header('Cache-Control', 'public, max-age=300')\r\n   ```\r\n\r\n---\r\n\r\n### Development Workflow\r\n\r\n1. **Use environment-specific configs**:\r\n   ```typescript\r\n   const isDev = process.env.NODE_ENV === 'development'\r\n\r\n   export const auth = betterAuth({\r\n     database: /* ... */,\r\n     baseURL: isDev\r\n       ? 'http://localhost:3000'\r\n       : 'https://yourdomain.com',\r\n     session: {\r\n       expiresIn: isDev\r\n         ? 60 * 60 * 24 * 365 // 1 year for dev\r\n         : 60 * 60 * 24 * 7    // 7 days for prod\r\n     }\r\n   })\r\n   ```\r\n\r\n2. **Test social auth locally** with ngrok:\r\n   ```bash\r\n   ngrok http 3000\r\n   # Use ngrok URL as redirect URI in OAuth provider\r\n   ```\r\n\r\n3. **Seed test users** for development:\r\n   ```typescript\r\n   // seed.ts\r\n   const testUsers = [\r\n     { email: 'admin@test.com', password: 'password123', role: 'admin' },\r\n     { email: 'user@test.com', password: 'password123', role: 'user' }\r\n   ]\r\n\r\n   for (const user of testUsers) {\r\n     await authClient.signUp.email(user)\r\n   }\r\n   ```\r\n\r\n---",
    "Bundled Resources": "This skill includes the following reference implementations:\r\n\r\n1. **`scripts/setup-d1.sh`** - Automated D1 database setup for Cloudflare Workers\r\n2. **`references/cloudflare-worker-example.ts`** - Complete Worker with auth + protected routes\r\n3. **`references/nextjs-api-route.ts`** - Next.js API route pattern\r\n4. **`references/react-client-hooks.tsx`** - React components with auth hooks\r\n5. **`references/drizzle-schema.ts`** - Drizzle ORM schema for better-auth tables\r\n6. **`assets/auth-flow-diagram.md`** - Visual flow diagrams for OAuth, email verification\r\n\r\nUse `Read` tool to access these files when needed.\r\n\r\n---",
    "Database Setup": "wrangler d1 execute my-app-db --remote --file migrations/0001_initial.sql\r\n```\r\n\r\n**Manual schema** (if needed):\r\n```sql\r\n-- better-auth core tables\r\nCREATE TABLE users (\r\n  id TEXT PRIMARY KEY,\r\n  email TEXT UNIQUE NOT NULL,\r\n  emailVerified INTEGER DEFAULT 0,\r\n  name TEXT,\r\n  image TEXT,\r\n  createdAt INTEGER NOT NULL,\r\n  updatedAt INTEGER NOT NULL\r\n);\r\n\r\nCREATE TABLE sessions (\r\n  id TEXT PRIMARY KEY,\r\n  userId TEXT NOT NULL,\r\n  expiresAt INTEGER NOT NULL,\r\n  ipAddress TEXT,\r\n  userAgent TEXT,\r\n  FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE\r\n);\r\n\r\nCREATE TABLE accounts (\r\n  id TEXT PRIMARY KEY,\r\n  userId TEXT NOT NULL,\r\n  provider TEXT NOT NULL,\r\n  providerAccountId TEXT NOT NULL,\r\n  accessToken TEXT,\r\n  refreshToken TEXT,\r\n  expiresAt INTEGER,\r\n  FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE\r\n);\r\n\r\nCREATE TABLE verification_tokens (\r\n  identifier TEXT NOT NULL,\r\n  token TEXT NOT NULL,\r\n  expires INTEGER NOT NULL,\r\n  PRIMARY KEY (identifier, token)\r\n);\r\n\r\n-- Additional tables for plugins (organizations, 2FA, etc.)\r\n```\r\n\r\n---\r\n\r\n### PostgreSQL with Drizzle\r\n\r\n**File**: `src/db/schema.ts`\r\n```typescript\r\nimport { pgTable, text, timestamp, boolean } from 'drizzle-orm/pg-core'\r\n\r\nexport const users = pgTable('users', {\r\n  id: text('id').primaryKey(),\r\n  email: text('email').unique().notNull(),\r\n  emailVerified: boolean('email_verified').default(false),\r\n  name: text('name'),\r\n  image: text('image'),\r\n  createdAt: timestamp('created_at').notNull().defaultNow(),\r\n  updatedAt: timestamp('updated_at').notNull().defaultNow()\r\n})\r\n\r\n// ... other tables\r\n```\r\n\r\n**Setup**:\r\n```typescript\r\nimport { drizzle } from 'drizzle-orm/postgres-js'\r\nimport postgres from 'postgres'\r\nimport { betterAuth } from 'better-auth'\r\n\r\nconst client = postgres(process.env.DATABASE_URL!)\r\nconst db = drizzle(client)\r\n\r\nexport const auth = betterAuth({\r\n  database: db,\r\n  // ...\r\n})\r\n```\r\n\r\n---",
    "Comparison: better-auth vs Alternatives": "| Feature | better-auth | Clerk | Auth.js |\r\n|---------|-------------|-------|---------|\r\n| **Hosting** | Self-hosted | Third-party | Self-hosted |\r\n| **Cost** | Free (OSS) | $25/mo+ | Free (OSS) |\r\n| **Cloudflare D1** | ✅ First-class | ❌ No | ✅ Adapter |\r\n| **Social Auth** | ✅ 10+ providers | ✅ Many | ✅ Many |\r\n| **2FA/Passkeys** | ✅ Plugin | ✅ Built-in | ⚠️ Limited |\r\n| **Organizations** | ✅ Plugin | ✅ Built-in | ❌ No |\r\n| **Multi-tenant** | ✅ Plugin | ✅ Yes | ❌ No |\r\n| **RBAC** | ✅ Plugin | ✅ Yes | ⚠️ Custom |\r\n| **Magic Links** | ✅ Built-in | ✅ Yes | ✅ Yes |\r\n| **Email/Password** | ✅ Built-in | ✅ Yes | ✅ Yes |\r\n| **Session Management** | ✅ JWT + DB | ✅ JWT | ✅ JWT + DB |\r\n| **TypeScript** | ✅ First-class | ✅ Yes | ✅ Yes |\r\n| **Framework Support** | ✅ Agnostic | ⚠️ React-focused | ✅ Agnostic |\r\n| **Vendor Lock-in** | ✅ None | ❌ High | ✅ None |\r\n| **Customization** | ✅ Full control | ⚠️ Limited | ✅ Full control |\r\n| **Production Ready** | ✅ Yes | ✅ Yes | ✅ Yes |\r\n\r\n**Recommendation**:\r\n- **Use better-auth if**: Self-hosted, Cloudflare D1, want full control, avoid vendor lock-in\r\n- **Use Clerk if**: Want managed service, don't mind cost, need fastest setup\r\n- **Use Auth.js if**: Already using Next.js, basic needs, familiar with it\r\n\r\n---",
    "Installation": "yarn add better-auth\r\n```\r\n\r\n### Database Adapters\r\n\r\n**For Cloudflare D1** (Workers):\r\n```bash\r\nnpm install @cloudflare/workers-types\r\n```\r\n\r\n**For PostgreSQL**:\r\n```bash\r\nnpm install pg drizzle-orm\r\n```\r\n\r\n**For MySQL/SQLite**: Built-in adapters, no extra packages needed.\r\n\r\n### Social Providers (Optional)\r\n\r\n```bash\r\nnpm install @better-auth/google\r\nnpm install @better-auth/github\r\nnpm install @better-auth/microsoft\r\n```\r\n\r\n---",
    "Social Provider Setup": "### Google OAuth\r\n\r\n1. **Create OAuth credentials**: https://console.cloud.google.com/apis/credentials\r\n2. **Authorized redirect URI**: `https://yourdomain.com/api/auth/callback/google`\r\n3. **Environment variables**:\r\n   ```env\r\n   GOOGLE_CLIENT_ID=your-client-id\r\n   GOOGLE_CLIENT_SECRET=your-client-secret\r\n   ```\r\n\r\n**Configuration**:\r\n```typescript\r\nsocialProviders: {\r\n  google: {\r\n    clientId: process.env.GOOGLE_CLIENT_ID!,\r\n    clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n    scope: ['email', 'profile'] // Optional\r\n  }\r\n}\r\n```\r\n\r\n---\r\n\r\n### GitHub OAuth\r\n\r\n1. **Create OAuth app**: https://github.com/settings/developers\r\n2. **Authorization callback URL**: `https://yourdomain.com/api/auth/callback/github`\r\n3. **Environment variables**:\r\n   ```env\r\n   GITHUB_CLIENT_ID=your-client-id\r\n   GITHUB_CLIENT_SECRET=your-client-secret\r\n   ```\r\n\r\n**Configuration**:\r\n```typescript\r\nsocialProviders: {\r\n  github: {\r\n    clientId: process.env.GITHUB_CLIENT_ID!,\r\n    clientSecret: process.env.GITHUB_CLIENT_SECRET!\r\n  }\r\n}\r\n```\r\n\r\n---\r\n\r\n### Microsoft OAuth\r\n\r\n```bash\r\nnpm install @better-auth/microsoft\r\n```\r\n\r\n1. **Azure Portal**: https://portal.azure.com → App registrations\r\n2. **Redirect URI**: `https://yourdomain.com/api/auth/callback/microsoft`\r\n3. **Environment variables**:\r\n   ```env\r\n   MICROSOFT_CLIENT_ID=your-client-id\r\n   MICROSOFT_CLIENT_SECRET=your-client-secret\r\n   MICROSOFT_TENANT_ID=common  # or your tenant ID\r\n   ```\r\n\r\n**Configuration**:\r\n```typescript\r\nimport { microsoft } from '@better-auth/microsoft'\r\n\r\nsocialProviders: {\r\n  microsoft: microsoft({\r\n    clientId: process.env.MICROSOFT_CLIENT_ID!,\r\n    clientSecret: process.env.MICROSOFT_CLIENT_SECRET!,\r\n    tenantId: process.env.MICROSOFT_TENANT_ID!\r\n  })\r\n}\r\n```\r\n\r\n---",
    "Token Efficiency": "**Without this skill**: ~15,000 tokens (setup trial-and-error, debugging CORS, D1 adapter, OAuth flows)\r\n**With this skill**: ~4,500 tokens (direct implementation from patterns)\r\n**Savings**: ~70% (10,500 tokens)\r\n\r\n**Errors prevented**: 10 common issues documented with solutions\r\n\r\n---",
    "Known Issues & Solutions": "### Issue 1: D1 Eventual Consistency\r\n\r\n**Problem**: Session reads immediately after write may return stale data in D1.\r\n\r\n**Symptoms**: User logs in but `getSession()` returns null on next request.\r\n\r\n**Solution**: Use Cloudflare KV for session storage (strong consistency):\r\n```typescript\r\nimport { betterAuth } from 'better-auth'\r\n\r\nexport const auth = betterAuth({\r\n  database: d1Adapter(env.DB), // Users, accounts\r\n  session: {\r\n    storage: {\r\n      get: async (sessionId) => {\r\n        const session = await env.SESSIONS_KV.get(sessionId)\r\n        return session ? JSON.parse(session) : null\r\n      },\r\n      set: async (sessionId, session, ttl) => {\r\n        await env.SESSIONS_KV.put(\r\n          sessionId,\r\n          JSON.stringify(session),\r\n          { expirationTtl: ttl }\r\n        )\r\n      },\r\n      delete: async (sessionId) => {\r\n        await env.SESSIONS_KV.delete(sessionId)\r\n      }\r\n    }\r\n  }\r\n})\r\n```\r\n\r\n**Source**: https://github.com/better-auth/better-auth/issues/147\r\n\r\n---\r\n\r\n### Issue 2: CORS for SPA Applications\r\n\r\n**Problem**: CORS errors when auth API is on different origin than frontend.\r\n\r\n**Symptoms**: `Access-Control-Allow-Origin` errors in browser console.\r\n\r\n**Solution**: Configure CORS headers in Worker:\r\n```typescript\r\nimport { Hono } from 'hono'\r\nimport { cors } from 'hono/cors'\r\n\r\nconst app = new Hono<{ Bindings: Env }>()\r\n\r\napp.use('/api/auth/*', cors({\r\n  origin: ['https://yourdomain.com', 'http://localhost:3000'],\r\n  credentials: true, // Allow cookies\r\n  allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS']\r\n}))\r\n\r\napp.all('/api/auth/*', async (c) => {\r\n  const auth = betterAuth({ /* ... */ })\r\n  return auth.handler(c.req.raw)\r\n})\r\n```\r\n\r\n**Source**: https://better-auth.com/docs/guides/cors\r\n\r\n---\r\n\r\n### Issue 3: Session Serialization in Workers\r\n\r\n**Problem**: Can't serialize complex session objects in Cloudflare Workers.\r\n\r\n**Symptoms**: `DataCloneError` or session data missing.\r\n\r\n**Solution**: Keep session data minimal and JSON-serializable:\r\n```typescript\r\nexport const auth = betterAuth({\r\n  database: d1Adapter(env.DB),\r\n  session: {\r\n    // Only include serializable fields\r\n    fields: {\r\n      userId: true,\r\n      email: true,\r\n      role: true\r\n      // Don't include: functions, Dates, complex objects\r\n    }\r\n  }\r\n})\r\n```\r\n\r\n---\r\n\r\n### Issue 4: OAuth Redirect URI Mismatch\r\n\r\n**Problem**: Social sign-in fails with \"redirect_uri_mismatch\" error.\r\n\r\n**Symptoms**: Google/GitHub OAuth returns error after user consent.\r\n\r\n**Solution**: Ensure exact match in OAuth provider settings:\r\n```\r\nProvider setting: https://yourdomain.com/api/auth/callback/google\r\nbetter-auth URL:  https://yourdomain.com/api/auth/callback/google\r\n\r\n❌ Wrong: http vs https, trailing slash, subdomain mismatch\r\n✅ Right: Exact character-for-character match\r\n```\r\n\r\n**Check better-auth callback URL**:\r\n```typescript\r\n// It's always: {baseURL}/api/auth/callback/{provider}\r\nconst callbackURL = `${process.env.NEXT_PUBLIC_API_URL}/api/auth/callback/google`\r\nconsole.log('Configure this URL in Google Console:', callbackURL)\r\n```\r\n\r\n---\r\n\r\n### Issue 5: Email Verification Not Sending\r\n\r\n**Problem**: Email verification links never arrive.\r\n\r\n**Symptoms**: User signs up, but no email received.\r\n\r\n**Solution**: Implement `sendVerificationEmail` handler:\r\n```typescript\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  emailAndPassword: {\r\n    enabled: true,\r\n    requireEmailVerification: true,\r\n    sendVerificationEmail: async ({ user, url, token }) => {\r\n      // Use your email service (SendGrid, Resend, etc.)\r\n      await sendEmail({\r\n        to: user.email,\r\n        subject: 'Verify your email',\r\n        html: `\r\n          <p>Click the link below to verify your email:</p>\r\n          <a href=\"${url}\">Verify Email</a>\r\n          <p>Or use this code: ${token}</p>\r\n        `\r\n      })\r\n    }\r\n  }\r\n})\r\n```\r\n\r\n**For Cloudflare**: Use Cloudflare Email Routing or external service (Resend, SendGrid).\r\n\r\n---\r\n\r\n### Issue 6: JWT Token Expiration\r\n\r\n**Problem**: Session expires too quickly or never expires.\r\n\r\n**Symptoms**: User logged out unexpectedly or session persists after logout.\r\n\r\n**Solution**: Configure session expiration:\r\n```typescript\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  session: {\r\n    expiresIn: 60 * 60 * 24 * 7, // 7 days (in seconds)\r\n    updateAge: 60 * 60 * 24 // Update session every 24 hours\r\n  }\r\n})\r\n```\r\n\r\n---\r\n\r\n### Issue 7: Password Hashing Performance\r\n\r\n**Problem**: Sign-up/login slow on Cloudflare Workers.\r\n\r\n**Symptoms**: Auth requests take >1 second.\r\n\r\n**Solution**: better-auth uses bcrypt by default, which is CPU-intensive. For Workers, ensure proper async handling:\r\n```typescript\r\n// better-auth handles this internally, but if custom:\r\nimport bcrypt from 'bcryptjs'\r\n\r\n// Use async version (not sync)\r\nconst hash = await bcrypt.hash(password, 10) // ✅\r\nconst isValid = await bcrypt.compare(password, hash) // ✅\r\n\r\n// Don't use:\r\nconst hash = bcrypt.hashSync(password, 10) // ❌ (blocks)\r\n```\r\n\r\n**Alternative**: Use better-auth's built-in hashing (already optimized).\r\n\r\n---\r\n\r\n### Issue 8: Social Provider Scope Issues\r\n\r\n**Problem**: Social sign-in succeeds but missing user data (name, avatar).\r\n\r\n**Symptoms**: `session.user.name` is null after Google/GitHub sign-in.\r\n\r\n**Solution**: Request additional scopes:\r\n```typescript\r\nsocialProviders: {\r\n  google: {\r\n    clientId: process.env.GOOGLE_CLIENT_ID!,\r\n    clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n    scope: ['openid', 'email', 'profile'] // Include 'profile' for name/image\r\n  },\r\n  github: {\r\n    clientId: process.env.GITHUB_CLIENT_ID!,\r\n    clientSecret: process.env.GITHUB_CLIENT_SECRET!,\r\n    scope: ['user:email', 'read:user'] // 'read:user' for full profile\r\n  }\r\n}\r\n```\r\n\r\n---\r\n\r\n### Issue 9: Multi-Tenant Data Leakage\r\n\r\n**Problem**: Users see data from other tenants.\r\n\r\n**Symptoms**: User in Org A sees Org B's data.\r\n\r\n**Solution**: Always filter queries by tenant ID:\r\n```typescript\r\nimport { multiTenant } from 'better-auth/plugins'\r\n\r\nexport const auth = betterAuth({\r\n  database: /* ... */,\r\n  plugins: [\r\n    multiTenant({\r\n      tenantIdHeader: 'x-tenant-id',\r\n      isolateData: true // Enforces tenant isolation\r\n    })\r\n  ]\r\n})\r\n\r\n// In API routes\r\napp.get('/api/data', async (c) => {\r\n  const session = await auth.getSession(c.req.raw)\r\n  const tenantId = c.req.header('x-tenant-id')\r\n\r\n  // ALWAYS filter by tenant\r\n  const data = await db.query.items.findMany({\r\n    where: eq(items.tenantId, tenantId)\r\n  })\r\n\r\n  return c.json(data)\r\n})\r\n```\r\n\r\n---\r\n\r\n### Issue 10: Rate Limit False Positives\r\n\r\n**Problem**: Legitimate users blocked by rate limiting.\r\n\r\n**Symptoms**: \"Too many requests\" errors for normal usage.\r\n\r\n**Solution**: Use IP + user ID for rate limit keys:\r\n```typescript\r\nimport { rateLimit } from 'better-auth/plugins'\r\n\r\nplugins: [\r\n  rateLimit({\r\n    window: 60,\r\n    max: 10,\r\n    keyGenerator: (req) => {\r\n      // Combine IP and user ID (if authenticated)\r\n      const ip = req.headers.get('cf-connecting-ip') || 'unknown'\r\n      const userId = req.session?.userId || 'anonymous'\r\n      return `${ip}:${userId}`\r\n    }\r\n  })\r\n]\r\n```\r\n\r\n---",
    "Overview": "**better-auth** is a comprehensive, framework-agnostic authentication and authorization library for TypeScript. It provides a complete auth solution with first-class support for Cloudflare D1, making it an excellent self-hosted alternative to Clerk or Auth.js.\r\n\r\n**Use this skill when**:\r\n- Building authentication for Cloudflare Workers + D1 applications\r\n- Need a self-hosted, vendor-independent auth solution\r\n- Migrating from Clerk (avoid vendor lock-in)\r\n- Upgrading from Auth.js (need more features)\r\n- Implementing multi-tenant SaaS with organizations/teams\r\n- Require advanced features: 2FA, passkeys, RBAC, social auth\r\n\r\n**Package**: `better-auth@1.3.34` (latest verified 2025-10-31)\r\n\r\n---"
  }
}
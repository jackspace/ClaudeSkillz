{
  "description": "Process multimedia files with FFmpeg (video/audio encoding, conversion, streaming, filtering, hardware acceleration) and ImageMagick (image manipulation, format conversion, batch processing, effects, composition). Use when converting media formats, encoding videos with specific codecs (H.264, H.265, VP9), resizing/cropping images, extracting audio from video, applying filters and effects, optimizing file sizes, creating streaming manifests (HLS/DASH), generating thumbnails, batch processing images, creating composite images, or implementing media processing pipelines. Supports 100+ formats, hardware acceleration (NVENC, QSV), and complex filtergraphs.",
  "metadata": {
    "license": "MIT"
  },
  "references": {
    "files": [
      "references/ffmpeg-encoding.md",
      "references/ffmpeg-filters.md",
      "references/ffmpeg-streaming.md",
      "references/format-compatibility.md",
      "references/imagemagick-batch.md",
      "references/imagemagick-editing.md"
    ]
  },
  "content": "Process video, audio, and images using FFmpeg and ImageMagick command-line tools for conversion, optimization, streaming, and manipulation tasks.\r\n\r\n\r\n### macOS\r\n```bash\r\nbrew install ffmpeg imagemagick\r\n```\r\n\r\n### Ubuntu/Debian\r\n```bash\r\nsudo apt-get install ffmpeg imagemagick\r\n```\r\n\r\n### Windows\r\n```bash\r\nwinget install ffmpeg\r\nwinget install ImageMagick.ImageMagick\r\n\r\n```\r\n\r\n### Verify Installation\r\n```bash\r\nffmpeg -version\r\nffprobe -version\r\nmagick -version\r\n\r\n### Video Conversion\r\n```bash\r\nffmpeg -i input.mkv -c copy output.mp4\r\n\r\nffmpeg -i input.avi -c:v libx264 -crf 22 -c:a aac output.mp4\r\n\r\nffmpeg -i input.mp4 -vf scale=-1:720 -c:a copy output.mp4\r\n```\r\n\r\n### Audio Extraction\r\n```bash\r\nffmpeg -i video.mp4 -vn -c:a copy audio.m4a\r\n\r\nffmpeg -i video.mp4 -vn -q:a 0 audio.mp3\r\n```\r\n\r\n### Image Processing\r\n```bash\r\nmagick input.png output.jpg\r\n\r\nmagick input.jpg -resize 800x600 output.jpg\r\n\r\nmagick input.jpg -resize 200x200^ -gravity center -extent 200x200 thumb.jpg\r\n```\r\n\r\n### Batch Image Resize\r\n```bash\r\nmogrify -resize 800x -quality 85 *.jpg\r\n\r\nmogrify -path ./output -resize 800x600 *.jpg\r\n```\r\n\r\n### Video Thumbnail\r\n```bash\r\nffmpeg -ss 00:00:05 -i video.mp4 -vframes 1 -vf scale=320:-1 thumb.jpg\r\n```\r\n\r\n### HLS Streaming\r\n```bash\r\nffmpeg -i input.mp4 \\\r\n  -c:v libx264 -preset fast -crf 22 -g 48 \\\r\n  -c:a aac -b:a 128k \\\r\n  -f hls -hls_time 6 -hls_playlist_type vod \\\r\n  playlist.m3u8\r\n```\r\n\r\n### Image Watermark\r\n```bash\r\n\r\n### Optimize Video for Web\r\n```bash\r\nffmpeg -i input.mp4 \\\r\n  -c:v libx264 -preset slow -crf 23 \\\r\n  -c:a aac -b:a 128k \\\r\n  -movflags +faststart \\\r\n  output.mp4\r\n```\r\n\r\n### Create Responsive Images\r\n```bash\r\nfor size in 320 640 1024 1920; do\r\n  magick input.jpg -resize ${size}x -quality 85 \"output-${size}w.jpg\"\r\ndone\r\n```\r\n\r\n### Extract Video Segment\r\n```bash\r\nffmpeg -i input.mp4 -ss 00:01:30 -to 00:03:00 \\\r\n  -c:v libx264 -c:a aac output.mp4\r\n```\r\n\r\n### Batch Image Optimization\r\n```bash\r\nmogrify -path ./optimized -format jpg -quality 85 -strip *.png\r\n```\r\n\r\n### Video GIF Creation\r\n```bash\r\nffmpeg -i input.mp4 -vf \"fps=15,scale=640:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse\" output.gif\r\n```\r\n\r\n### Image Blur Effect\r\n```bash\r\n\r\n### Multi-Pass Video Encoding\r\n```bash\r\nffmpeg -y -i input.mkv -c:v libx264 -b:v 2600k -pass 1 -an -f null /dev/null\r\n\r\nffmpeg -i input.mkv -c:v libx264 -b:v 2600k -pass 2 -c:a aac output.mp4\r\n```\r\n\r\n### Hardware-Accelerated Encoding\r\n```bash\r\nffmpeg -hwaccel cuda -i input.mp4 -c:v h264_nvenc -preset fast -crf 22 output.mp4\r\n\r\nffmpeg -hwaccel qsv -c:v h264_qsv -i input.mp4 -c:v h264_qsv output.mp4\r\n```\r\n\r\n### Complex Image Pipeline\r\n```bash\r\nmagick input.jpg \\\r\n  -resize 1000x1000^ \\\r\n  -gravity center \\\r\n  -crop 1000x1000+0+0 +repage \\\r\n  -bordercolor black -border 5x5 \\\r\n  -brightness-contrast 5x10 \\\r\n  -quality 90 \\\r\n  output.jpg\r\n```\r\n\r\n### Video Filter Chains\r\n```bash\r\nffmpeg -i video.mp4 -i logo.png \\\r\n  -filter_complex \"[0:v]scale=1280:720,hqdn3d[v];[v][1:v]overlay=10:10\" \\\r\n  -c:a copy output.mp4\r\n```\r\n\r\n### Animated GIF from Images\r\n```bash\r\nmagick -delay 100 -loop 0 frame*.png animated.gif\r\n\r\n\r\n### Inspect Video Properties\r\n```bash\r\nffprobe -v quiet -print_format json -show_format -show_streams input.mp4\r\n\r\nffprobe -v error -select_streams v:0 \\\r\n  -show_entries stream=width,height \\\r\n  -of csv=s=x:p=0 input.mp4\r\n```\r\n\r\n### Image Information\r\n```bash\r\nidentify image.jpg\r\n\r\nidentify -verbose image.jpg\r\n\r\n\r\n**FFmpeg \"Unknown encoder\"**\r\n```bash\r\nffmpeg -encoders | grep h264\r\n\r\nsudo apt-get install libx264-dev libx265-dev\r\n```\r\n\r\n**ImageMagick \"not authorized\"**\r\n```bash\r\nsudo nano /etc/ImageMagick-7/policy.xml\r\n```\r\n\r\n**Memory errors**\r\n```bash",
  "name": "media-processing",
  "id": "media-processing_mrgoonie",
  "sections": {
    "Media Analysis": "identify -format \"%f: %wx%h %b\\n\" image.jpg\r\n```",
    "Reference Documentation": "Detailed guides in `references/`:\r\n\r\n- **ffmpeg-encoding.md** - Video/audio codecs, quality optimization, hardware acceleration\r\n- **ffmpeg-streaming.md** - HLS/DASH, live streaming, adaptive bitrate\r\n- **ffmpeg-filters.md** - Video/audio filters, complex filtergraphs\r\n- **imagemagick-editing.md** - Format conversion, effects, transformations\r\n- **imagemagick-batch.md** - Batch processing, mogrify, parallel operations\r\n- **format-compatibility.md** - Format support, codec recommendations",
    "Installation": "convert -version\r\n```",
    "Troubleshooting": "ffmpeg -threads 4 input.mp4 output.mp4\r\nmagick -limit memory 2GB -limit map 4GB input.jpg output.jpg\r\n```",
    "Advanced Techniques": "magick animated.gif -fuzz 5% -layers Optimize optimized.gif\r\n```",
    "Performance Tips": "1. **Use CRF for quality control** - Better than bitrate for video\r\n2. **Copy streams when possible** - Avoid re-encoding with `-c copy`\r\n3. **Hardware acceleration** - GPU encoding 5-10x faster\r\n4. **Appropriate presets** - Balance speed vs compression\r\n5. **Batch with mogrify** - In-place image processing\r\n6. **Strip metadata** - Reduce file size with `-strip`\r\n7. **Progressive JPEG** - Better web loading with `-interlace Plane`\r\n8. **Limit memory** - Prevent crashes on large batches\r\n9. **Test on samples** - Verify settings before batch\r\n10. **Parallel processing** - Use GNU Parallel for multiple files",
    "When to Use This Skill": "Use when:\r\n- Converting media formats (video, audio, images)\r\n- Encoding video with codecs (H.264, H.265, VP9, AV1)\r\n- Processing images (resize, crop, effects, watermarks)\r\n- Extracting audio from video\r\n- Creating streaming manifests (HLS/DASH)\r\n- Generating thumbnails and previews\r\n- Batch processing media files\r\n- Optimizing file sizes and quality\r\n- Applying filters and effects\r\n- Creating composite images or videos",
    "Tool Selection Guide": "### FFmpeg: Video/Audio Processing\r\nUse FFmpeg for:\r\n- Video encoding, conversion, transcoding\r\n- Audio extraction, conversion, mixing\r\n- Live streaming (RTMP, HLS, DASH)\r\n- Video filters (scale, crop, rotate, overlay)\r\n- Hardware-accelerated encoding\r\n- Media file inspection (ffprobe)\r\n- Frame extraction, concatenation\r\n- Codec selection and optimization\r\n\r\n### ImageMagick: Image Processing\r\nUse ImageMagick for:\r\n- Image format conversion (PNG, JPEG, WebP, GIF)\r\n- Resizing, cropping, transformations\r\n- Batch image processing (mogrify)\r\n- Visual effects (blur, sharpen, sepia)\r\n- Text overlays and watermarks\r\n- Image composition and montages\r\n- Color adjustments, filters\r\n- Thumbnail generation\r\n\r\n### Decision Matrix\r\n\r\n| Task | Tool | Why |\r\n|------|------|-----|\r\n| Video encoding | FFmpeg | Native video codec support |\r\n| Audio extraction | FFmpeg | Direct stream manipulation |\r\n| Image resize | ImageMagick | Optimized for still images |\r\n| Batch images | ImageMagick | mogrify for in-place edits |\r\n| Video thumbnails | FFmpeg | Frame extraction built-in |\r\n| GIF creation | FFmpeg or ImageMagick | FFmpeg for video source, ImageMagick for images |\r\n| Streaming | FFmpeg | Live streaming protocols |\r\n| Image effects | ImageMagick | Rich filter library |",
    "Resources": "- FFmpeg: https://ffmpeg.org/documentation.html\r\n- FFmpeg Wiki: https://trac.ffmpeg.org/\r\n- ImageMagick: https://imagemagick.org/\r\n- ImageMagick Usage: https://imagemagick.org/Usage/",
    "Common Parameters": "### FFmpeg Video\r\n- `-c:v` - Video codec (libx264, libx265, libvpx-vp9)\r\n- `-crf` - Quality (0-51, lower=better, 23=default)\r\n- `-preset` - Speed/compression (ultrafast to veryslow)\r\n- `-b:v` - Video bitrate (e.g., 2M, 2500k)\r\n- `-vf` - Video filters\r\n\r\n### FFmpeg Audio\r\n- `-c:a` - Audio codec (aac, mp3, opus)\r\n- `-b:a` - Audio bitrate (e.g., 128k, 192k)\r\n- `-ar` - Sample rate (44100, 48000)\r\n\r\n### ImageMagick Geometry\r\n- `800x600` - Fit within (maintains aspect)\r\n- `800x600!` - Force exact size\r\n- `800x600^` - Fill (may crop)\r\n- `800x` - Width only\r\n- `x600` - Height only\r\n- `50%` - Scale percentage",
    "Common Workflows": "magick input.jpg -gaussian-blur 0x8 output.jpg\r\n```",
    "Quick Start Examples": "magick input.jpg watermark.png -gravity southeast \\\r\n  -geometry +10+10 -composite output.jpg\r\n```"
  }
}
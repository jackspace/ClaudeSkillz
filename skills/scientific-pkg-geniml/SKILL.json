{
  "description": "This skill should be used when working with genomic interval data (BED files) for machine learning tasks. Use for training region embeddings (Region2Vec, BEDspace), single-cell ATAC-seq analysis (scEmbed), building consensus peaks (universes), or any ML-based analysis of genomic regions. Applies to BED file collections, scATAC-seq data, chromatin accessibility datasets, and region-based genomic feature learning.",
  "references": {
    "files": [
      "references/bedspace.md",
      "references/consensus_peaks.md",
      "references/region2vec.md",
      "references/scembed.md",
      "references/utilities.md"
    ]
  },
  "content": "### Basic Region Embedding Pipeline\r\n\r\n```python\r\nfrom geniml.tokenization import hard_tokenization\r\nfrom geniml.region2vec import region2vec\r\nfrom geniml.evaluation import evaluate_embeddings\r\n\r\nhard_tokenization(\r\n    src_folder='bed_files/',\r\n    dst_folder='tokens/',\r\n    universe_file='universe.bed',\r\n    p_value_threshold=1e-9\r\n)\r\n\r\nregion2vec(\r\n    token_folder='tokens/',\r\n    save_dir='model/',\r\n    num_shufflings=1000,\r\n    embedding_dim=100\r\n)\r\n\r\nmetrics = evaluate_embeddings(\r\n    embeddings_file='model/embeddings.npy',\r\n    labels_file='metadata.csv'\r\n)\r\n```\r\n\r\n### scATAC-seq Analysis Pipeline\r\n\r\n```python\r\nimport scanpy as sc\r\nfrom geniml.scembed import ScEmbed\r\nfrom geniml.io import tokenize_cells\r\n\r\nadata = sc.read_h5ad('scatac_data.h5ad')\r\n\r\ntokenize_cells(\r\n    adata='scatac_data.h5ad',\r\n    universe_file='universe.bed',\r\n    output='tokens.parquet'\r\n)\r\n\r\nmodel = ScEmbed(embedding_dim=100)\r\nmodel.train(dataset='tokens.parquet', epochs=100)\r\n\r\nembeddings = model.encode(adata)\r\nadata.obsm['scembed_X'] = embeddings\r\n\r\nsc.pp.neighbors(adata, use_rep='scembed_X')\r\nsc.tl.leiden(adata)\r\nsc.tl.umap(adata)\r\n```\r\n\r\n### Universe Building and Evaluation\r\n\r\n```bash\r\ncat bed_files/*.bed > combined.bed\r\nuniwig -m 25 combined.bed chrom.sizes coverage/\r\n\r\ngeniml universe build cc \\\r\n  --coverage-folder coverage/ \\\r\n  --output-file universe.bed \\\r\n  --cutoff 5 \\\r\n  --merge 100 \\\r\n  --filter-size 50\r\n\r\n\r\nGeniml provides command-line interfaces for major operations:\r\n\r\n```bash\r\ngeniml region2vec --token-folder tokens/ --save-dir model/ --num-shuffle 1000\r\n\r\ngeniml bedspace preprocess --input regions/ --metadata labels.csv --universe universe.bed\r\n\r\ngeniml bedspace train --input preprocessed.txt --output model/ --dim 100\r\n\r\ngeniml bedspace search -t r2l -d distances.pkl -q query.bed -n 10\r\n\r\ngeniml universe build cc --coverage-folder coverage/ --output universe.bed --cutoff 5",
  "name": "geniml",
  "id": "scientific-pkg-geniml",
  "sections": {
    "Best Practices": "### General Guidelines\r\n\r\n- **Universe quality is critical**: Invest time in building comprehensive, well-constructed universes\r\n- **Tokenization validation**: Check coverage (>80% ideal) before training\r\n- **Parameter tuning**: Experiment with embedding dimensions, learning rates, and training epochs\r\n- **Evaluation**: Always validate embeddings with multiple metrics and visualizations\r\n- **Documentation**: Record parameters and random seeds for reproducibility\r\n\r\n### Performance Considerations\r\n\r\n- **Pre-tokenization**: For scEmbed, always pre-tokenize cells for faster training\r\n- **Memory management**: Large datasets may require batch processing or downsampling\r\n- **Computational resources**: ML/HMM universe methods are computationally intensive\r\n- **Model caching**: Use BBClient to avoid repeated downloads\r\n\r\n### Integration Patterns\r\n\r\n- **With scanpy**: scEmbed embeddings integrate seamlessly as `adata.obsm` entries\r\n- **With BEDbase**: Use BBClient for accessing remote BED repositories\r\n- **With Hugging Face**: Export trained models for sharing and reproducibility\r\n- **With R**: Use reticulate for R integration (see utilities reference)",
    "When to Use Which Tool": "**Use Region2Vec when:**\r\n- Working with bulk genomic data (ChIP-seq, ATAC-seq, etc.)\r\n- Need unsupervised embeddings without metadata\r\n- Comparing region sets across experiments\r\n- Building features for downstream supervised learning\r\n\r\n**Use BEDspace when:**\r\n- Metadata labels available (cell types, tissues, conditions)\r\n- Need to query regions by metadata or vice versa\r\n- Want joint embedding space for regions and labels\r\n- Building searchable genomic databases\r\n\r\n**Use scEmbed when:**\r\n- Analyzing single-cell ATAC-seq data\r\n- Clustering cells by chromatin accessibility\r\n- Annotating cell types from scATAC-seq\r\n- Integration with scanpy is desired\r\n\r\n**Use Universe Building when:**\r\n- Need reference peak sets for tokenization\r\n- Combining multiple experiments into consensus\r\n- Want statistically rigorous region definitions\r\n- Building standard references for a project\r\n\r\n**Use Utilities when:**\r\n- Need to cache remote BED files (BBClient)\r\n- Generating null models for statistics (BEDshift)\r\n- Evaluating embedding quality (Evaluation)\r\n- Building search interfaces (Text2BedNN)",
    "Additional Resources": "- **Documentation**: https://docs.bedbase.org/geniml/\r\n- **GitHub**: https://github.com/databio/geniml\r\n- **Pre-trained models**: Available on Hugging Face (databio organization)\r\n- **Publications**: Cited in documentation for methodological details",
    "Installation": "Install geniml using uv:\r\n\r\n```bash\r\nuv pip install geniml\r\n```\r\n\r\nFor ML dependencies (PyTorch, etc.):\r\n\r\n```bash\r\nuv pip install 'geniml[ml]'\r\n```\r\n\r\nDevelopment version from GitHub:\r\n\r\n```bash\r\nuv pip install git+https://github.com/databio/geniml.git\r\n```",
    "Troubleshooting": "**\"Tokenization coverage too low\":**\r\n- Check universe quality and completeness\r\n- Adjust p-value threshold (try 1e-6 instead of 1e-9)\r\n- Ensure universe matches genome assembly\r\n\r\n**\"Training not converging\":**\r\n- Adjust learning rate (try 0.01-0.05 range)\r\n- Increase training epochs\r\n- Check data quality and preprocessing\r\n\r\n**\"Out of memory errors\":**\r\n- Reduce batch size for scEmbed\r\n- Process data in chunks\r\n- Use pre-tokenization for single-cell data\r\n\r\n**\"StarSpace not found\" (BEDspace):**\r\n- Install StarSpace separately: https://github.com/facebookresearch/StarSpace\r\n- Set `--path-to-starspace` parameter correctly\r\n\r\nFor detailed troubleshooting and method-specific issues, consult the appropriate reference file.",
    "Overview": "Geniml is a Python package for building machine learning models on genomic interval data from BED files. It provides unsupervised methods for learning embeddings of genomic regions, single cells, and metadata labels, enabling similarity searches, clustering, and downstream ML tasks.",
    "Core Capabilities": "Geniml provides five primary capabilities, each detailed in dedicated reference files:\r\n\r\n### 1. Region2Vec: Genomic Region Embeddings\r\n\r\nTrain unsupervised embeddings of genomic regions using word2vec-style learning.\r\n\r\n**Use for:** Dimensionality reduction of BED files, region similarity analysis, feature vectors for downstream ML.\r\n\r\n**Workflow:**\r\n1. Tokenize BED files using a universe reference\r\n2. Train Region2Vec model on tokens\r\n3. Generate embeddings for regions\r\n\r\n**Reference:** See `references/region2vec.md` for detailed workflow, parameters, and examples.\r\n\r\n### 2. BEDspace: Joint Region and Metadata Embeddings\r\n\r\nTrain shared embeddings for region sets and metadata labels using StarSpace.\r\n\r\n**Use for:** Metadata-aware searches, cross-modal queries (region→label or label→region), joint analysis of genomic content and experimental conditions.\r\n\r\n**Workflow:**\r\n1. Preprocess regions and metadata\r\n2. Train BEDspace model\r\n3. Compute distances\r\n4. Query across regions and labels\r\n\r\n**Reference:** See `references/bedspace.md` for detailed workflow, search types, and examples.\r\n\r\n### 3. scEmbed: Single-Cell Chromatin Accessibility Embeddings\r\n\r\nTrain Region2Vec models on single-cell ATAC-seq data for cell-level embeddings.\r\n\r\n**Use for:** scATAC-seq clustering, cell-type annotation, dimensionality reduction of single cells, integration with scanpy workflows.\r\n\r\n**Workflow:**\r\n1. Prepare AnnData with peak coordinates\r\n2. Pre-tokenize cells\r\n3. Train scEmbed model\r\n4. Generate cell embeddings\r\n5. Cluster and visualize with scanpy\r\n\r\n**Reference:** See `references/scembed.md` for detailed workflow, parameters, and examples.\r\n\r\n### 4. Consensus Peaks: Universe Building\r\n\r\nBuild reference peak sets (universes) from BED file collections using multiple statistical methods.\r\n\r\n**Use for:** Creating tokenization references, standardizing regions across datasets, defining consensus features with statistical rigor.\r\n\r\n**Workflow:**\r\n1. Combine BED files\r\n2. Generate coverage tracks\r\n3. Build universe using CC, CCF, ML, or HMM method\r\n\r\n**Methods:**\r\n- **CC (Coverage Cutoff)**: Simple threshold-based\r\n- **CCF (Coverage Cutoff Flexible)**: Confidence intervals for boundaries\r\n- **ML (Maximum Likelihood)**: Probabilistic modeling of positions\r\n- **HMM (Hidden Markov Model)**: Complex state modeling\r\n\r\n**Reference:** See `references/consensus_peaks.md` for method comparison, parameters, and examples.\r\n\r\n### 5. Utilities: Supporting Tools\r\n\r\nAdditional tools for caching, randomization, evaluation, and search.\r\n\r\n**Available utilities:**\r\n- **BBClient**: BED file caching for repeated access\r\n- **BEDshift**: Randomization preserving genomic context\r\n- **Evaluation**: Metrics for embedding quality (silhouette, Davies-Bouldin, etc.)\r\n- **Tokenization**: Region tokenization utilities (hard, soft, universe-based)\r\n- **Text2BedNN**: Neural search backends for genomic queries\r\n\r\n**Reference:** See `references/utilities.md` for detailed usage of each utility.",
    "CLI Reference": "geniml bedshift --input peaks.bed --genome hg38 --preserve-chrom --iterations 100\r\n```",
    "Common Workflows": "geniml universe evaluate \\\r\n  --universe universe.bed \\\r\n  --coverage-folder coverage/ \\\r\n  --bed-folder bed_files/\r\n```",
    "Related Projects": "Geniml is part of the BEDbase ecosystem:\r\n\r\n- **BEDbase**: Unified platform for genomic regions\r\n- **BEDboss**: Processing pipeline for BED files\r\n- **Gtars**: Genomic tools and utilities\r\n- **BBClient**: Client for BEDbase repositories"
  }
}
{
  "description": "\"Query openFDA API for drugs, devices, adverse events, recalls, regulatory submissions (510k, PMA), substance identification (UNII), for FDA regulatory data analysis and safety research.\"",
  "references": {
    "files": [
      "references/animal_veterinary.md",
      "references/api_basics.md",
      "references/devices.md",
      "references/drugs.md",
      "references/foods.md",
      "references/other.md"
    ]
  },
  "content": "### 1. Basic Setup\r\n\r\n```python\r\nfrom scripts.fda_query import FDAQuery\r\n\r\nfda = FDAQuery(api_key=\"YOUR_API_KEY\")\r\n\r\nevents = fda.query_drug_events(\"aspirin\", limit=100)\r\n\r\nlabel = fda.query_drug_label(\"Lipitor\", brand=True)\r\n\r\nrecalls = fda.query(\"device\", \"enforcement\",\r\n                   search=\"classification:Class+I\",\r\n                   limit=50)\r\n```\r\n\r\n### 2. API Key Setup\r\n\r\nWhile the API works without a key, registering provides higher rate limits:\r\n- **Without key**: 240 requests/min, 1,000/day\r\n- **With key**: 240 requests/min, 120,000/day\r\n\r\nRegister at: https://open.fda.gov/apis/authentication/\r\n\r\nSet as environment variable:\r\n```bash\r\nexport FDA_API_KEY=\"your_key_here\"\r\n```\r\n\r\n### 3. Running Examples\r\n\r\n```bash\r\npython scripts/fda_examples.py\r\n\r\n\r\n### Drugs\r\n\r\nAccess 6 drug-related endpoints covering the full drug lifecycle from approval to post-market surveillance.\r\n\r\n**Endpoints:**\r\n1. **Adverse Events** - Reports of side effects, errors, and therapeutic failures\r\n2. **Product Labeling** - Prescribing information, warnings, indications\r\n3. **NDC Directory** - National Drug Code product information\r\n4. **Enforcement Reports** - Drug recalls and safety actions\r\n5. **Drugs@FDA** - Historical approval data since 1939\r\n6. **Drug Shortages** - Current and resolved supply issues\r\n\r\n**Common use cases:**\r\n```python\r\nfda.count_by_field(\"drug\", \"event\",\r\n                  search=\"patient.drug.medicinalproduct:metformin\",\r\n                  field=\"patient.reaction.reactionmeddrapt\")\r\n\r\nlabel = fda.query_drug_label(\"Keytruda\", brand=True)\r\n\r\nrecalls = fda.query_drug_recalls(drug_name=\"metformin\")\r\n\r\nshortages = fda.query(\"drug\", \"drugshortages\",\r\n                     search=\"status:Currently+in+Shortage\")\r\n```\r\n\r\n**Reference:** See `references/drugs.md` for detailed documentation\r\n\r\n### Devices\r\n\r\nAccess 9 device-related endpoints covering medical device safety, approvals, and registrations.\r\n\r\n**Endpoints:**\r\n1. **Adverse Events** - Device malfunctions, injuries, deaths\r\n2. **510(k) Clearances** - Premarket notifications\r\n3. **Classification** - Device categories and risk classes\r\n4. **Enforcement Reports** - Device recalls\r\n5. **Recalls** - Detailed recall information\r\n6. **PMA** - Premarket approval data for Class III devices\r\n7. **Registrations & Listings** - Manufacturing facility data\r\n8. **UDI** - Unique Device Identification database\r\n9. **COVID-19 Serology** - Antibody test performance data\r\n\r\n**Common use cases:**\r\n```python\r\nevents = fda.query_device_events(\"pacemaker\", limit=100)\r\n\r\nclassification = fda.query_device_classification(\"DQY\")\r\n\r\nclearances = fda.query_device_510k(applicant=\"Medtronic\")\r\n\r\ndevice_info = fda.query(\"device\", \"udi\",\r\n                       search=\"identifiers.id:00884838003019\")\r\n```\r\n\r\n**Reference:** See `references/devices.md` for detailed documentation\r\n\r\n### Foods\r\n\r\nAccess 2 food-related endpoints for safety monitoring and recalls.\r\n\r\n**Endpoints:**\r\n1. **Adverse Events** - Food, dietary supplement, and cosmetic events\r\n2. **Enforcement Reports** - Food product recalls\r\n\r\n**Common use cases:**\r\n```python\r\nrecalls = fda.query_food_recalls(reason=\"undeclared peanut\")\r\n\r\nevents = fda.query_food_events(\r\n    industry=\"Dietary Supplements\")\r\n\r\nlisteria = fda.query_food_recalls(\r\n    reason=\"listeria\",\r\n    classification=\"I\")\r\n```\r\n\r\n**Reference:** See `references/foods.md` for detailed documentation\r\n\r\n### Animal & Veterinary\r\n\r\nAccess veterinary drug adverse event data with species-specific information.\r\n\r\n**Endpoint:**\r\n1. **Adverse Events** - Animal drug side effects by species, breed, and product\r\n\r\n**Common use cases:**\r\n```python\r\ndog_events = fda.query_animal_events(\r\n    species=\"Dog\",\r\n    drug_name=\"flea collar\")\r\n\r\nbreed_query = fda.query(\"animalandveterinary\", \"event\",\r\n    search=\"reaction.veddra_term_name:*seizure*+AND+\"\r\n           \"animal.breed.breed_component:*Labrador*\")\r\n```\r\n\r\n**Reference:** See `references/animal_veterinary.md` for detailed documentation\r\n\r\n### Substances & Other\r\n\r\nAccess molecular-level substance data with UNII codes, chemical structures, and relationships.\r\n\r\n**Endpoints:**\r\n1. **Substance Data** - UNII, CAS, chemical structures, relationships\r\n2. **NSDE** - Historical substance data (legacy)\r\n\r\n**Common use cases:**\r\n```python\r\nsubstance = fda.query_substance_by_unii(\"R16CO5Y76E\")\r\n\r\nresults = fda.query_substance_by_name(\"acetaminophen\")\r\n\r\n\r\n### Response Structure\r\n\r\nAll API responses follow this structure:\r\n\r\n```python\r\n{\r\n    \"meta\": {\r\n        \"disclaimer\": \"...\",\r\n        \"results\": {\r\n            \"skip\": 0,\r\n            \"limit\": 100,\r\n            \"total\": 15234\r\n        }\r\n    },\r\n    \"results\": [\r\n        # Array of result objects\r\n    ]\r\n}\r\n```\r\n\r\n### Error Handling\r\n\r\nAlways handle potential errors:\r\n\r\n```python\r\nresult = fda.query_drug_events(\"aspirin\", limit=10)\r\n\r\nif \"error\" in result:\r\n    print(f\"Error: {result['error']}\")\r\nelif \"results\" not in result or len(result[\"results\"]) == 0:\r\n    print(\"No results found\")\r\nelse:\r\n    # Process results\r\n    for event in result[\"results\"]:\r\n        # Handle event data\r\n        pass\r\n```\r\n\r\n### Pagination\r\n\r\nFor large result sets, use pagination:\r\n\r\n```python\r\nall_results = fda.query_all(\r\n    \"drug\", \"event\",\r\n    search=\"patient.drug.medicinalproduct:aspirin\",\r\n    max_results=5000\r\n)\r\n\r\n\r\n### 1. Use Specific Searches\r\n\r\n**DO:**\r\n```python\r\nsearch=\"patient.drug.medicinalproduct:aspirin\"\r\n```\r\n\r\n**DON'T:**\r\n```python\r\nsearch=\"*aspirin*\"\r\n```\r\n\r\n### 2. Implement Rate Limiting\r\n\r\nThe `FDAQuery` class handles rate limiting automatically, but be aware of limits:\r\n- 240 requests per minute\r\n- 120,000 requests per day (with API key)\r\n\r\n### 3. Cache Frequently Accessed Data\r\n\r\nThe `FDAQuery` class includes built-in caching (enabled by default):\r\n\r\n```python\r\nfda = FDAQuery(api_key=api_key, use_cache=True, cache_ttl=3600)\r\n```\r\n\r\n### 4. Use Exact Matching for Counting\r\n\r\nWhen counting/aggregating, use `.exact` suffix:\r\n\r\n```python",
  "name": "fda-database",
  "id": "scientific-db-fda-database",
  "sections": {
    "Quick Start": "```",
    "Best Practices": "fda.count_by_field(\"drug\", \"event\",\r\n                  search=\"...\",\r\n                  field=\"patient.reaction.reactionmeddrapt\",\r\n                  exact=True)  # Adds .exact automatically\r\n```\r\n\r\n### 5. Validate Input Data\r\n\r\nClean and validate search terms:\r\n\r\n```python\r\ndef clean_drug_name(name):\r\n    \"\"\"Clean drug name for query.\"\"\"\r\n    return name.strip().replace('\"', '\\\\\"')\r\n\r\ndrug_name = clean_drug_name(user_input)\r\n```",
    "Additional Resources": "- **openFDA Homepage**: https://open.fda.gov/\r\n- **API Documentation**: https://open.fda.gov/apis/\r\n- **Interactive API Explorer**: https://open.fda.gov/apis/try-the-api/\r\n- **GitHub Repository**: https://github.com/FDA/openfda\r\n- **Terms of Service**: https://open.fda.gov/terms/",
    "Overview": "Access comprehensive FDA regulatory data through openFDA, the FDA's initiative to provide open APIs for public datasets. Query information about drugs, medical devices, foods, animal/veterinary products, and substances using Python with standardized interfaces.\r\n\r\n**Key capabilities:**\r\n- Query adverse events for drugs, devices, foods, and veterinary products\r\n- Access product labeling, approvals, and regulatory submissions\r\n- Monitor recalls and enforcement actions\r\n- Look up National Drug Codes (NDC) and substance identifiers (UNII)\r\n- Analyze device classifications and clearances (510k, PMA)\r\n- Track drug shortages and supply issues\r\n- Research chemical structures and substance relationships",
    "FDA Database Categories": "structure = fda.query(\"other\", \"substance\",\r\n    search=\"names.name:ibuprofen+AND+substanceClass:chemical\")\r\n```\r\n\r\n**Reference:** See `references/other.md` for detailed documentation",
    "Working with Results": "for skip in range(0, 1000, 100):\r\n    batch = fda.query(\"drug\", \"event\",\r\n                     search=\"...\",\r\n                     limit=100,\r\n                     skip=skip)\r\n    # Process batch\r\n```",
    "When to Use This Skill": "This skill should be used when working with:\r\n- **Drug research**: Safety profiles, adverse events, labeling, approvals, shortages\r\n- **Medical device surveillance**: Adverse events, recalls, 510(k) clearances, PMA approvals\r\n- **Food safety**: Recalls, allergen tracking, adverse events, dietary supplements\r\n- **Veterinary medicine**: Animal drug adverse events by species and breed\r\n- **Chemical/substance data**: UNII lookup, CAS number mapping, molecular structures\r\n- **Regulatory analysis**: Approval pathways, enforcement actions, compliance tracking\r\n- **Pharmacovigilance**: Post-market surveillance, safety signal detection\r\n- **Scientific research**: Drug interactions, comparative safety, epidemiological studies",
    "Support and Troubleshooting": "### Common Issues\r\n\r\n**Issue**: Rate limit exceeded\r\n- **Solution**: Use API key, implement delays, or reduce request frequency\r\n\r\n**Issue**: No results found\r\n- **Solution**: Try broader search terms, check spelling, use wildcards\r\n\r\n**Issue**: Invalid query syntax\r\n- **Solution**: Review query syntax in `references/api_basics.md`\r\n\r\n**Issue**: Missing fields in results\r\n- **Solution**: Not all records contain all fields; always check field existence\r\n\r\n### Getting Help\r\n\r\n- **GitHub Issues**: https://github.com/FDA/openfda/issues\r\n- **Email**: open-fda@fda.hhs.gov",
    "API Reference": "For detailed information about:\r\n- **Authentication and rate limits** → See `references/api_basics.md`\r\n- **Drug databases** → See `references/drugs.md`\r\n- **Device databases** → See `references/devices.md`\r\n- **Food databases** → See `references/foods.md`\r\n- **Animal/veterinary databases** → See `references/animal_veterinary.md`\r\n- **Substance databases** → See `references/other.md`",
    "Common Query Patterns": "### Pattern 1: Safety Profile Analysis\r\n\r\nCreate comprehensive safety profiles combining multiple data sources:\r\n\r\n```python\r\ndef drug_safety_profile(fda, drug_name):\r\n    \"\"\"Generate complete safety profile.\"\"\"\r\n\r\n    # 1. Total adverse events\r\n    events = fda.query_drug_events(drug_name, limit=1)\r\n    total = events[\"meta\"][\"results\"][\"total\"]\r\n\r\n    # 2. Most common reactions\r\n    reactions = fda.count_by_field(\r\n        \"drug\", \"event\",\r\n        search=f\"patient.drug.medicinalproduct:*{drug_name}*\",\r\n        field=\"patient.reaction.reactionmeddrapt\",\r\n        exact=True\r\n    )\r\n\r\n    # 3. Serious events\r\n    serious = fda.query(\"drug\", \"event\",\r\n        search=f\"patient.drug.medicinalproduct:*{drug_name}*+AND+serious:1\",\r\n        limit=1)\r\n\r\n    # 4. Recent recalls\r\n    recalls = fda.query_drug_recalls(drug_name=drug_name)\r\n\r\n    return {\r\n        \"total_events\": total,\r\n        \"top_reactions\": reactions[\"results\"][:10],\r\n        \"serious_events\": serious[\"meta\"][\"results\"][\"total\"],\r\n        \"recalls\": recalls[\"results\"]\r\n    }\r\n```\r\n\r\n### Pattern 2: Temporal Trend Analysis\r\n\r\nAnalyze trends over time using date ranges:\r\n\r\n```python\r\nfrom datetime import datetime, timedelta\r\n\r\ndef get_monthly_trends(fda, drug_name, months=12):\r\n    \"\"\"Get monthly adverse event trends.\"\"\"\r\n    trends = []\r\n\r\n    for i in range(months):\r\n        end = datetime.now() - timedelta(days=30*i)\r\n        start = end - timedelta(days=30)\r\n\r\n        date_range = f\"[{start.strftime('%Y%m%d')}+TO+{end.strftime('%Y%m%d')}]\"\r\n        search = f\"patient.drug.medicinalproduct:*{drug_name}*+AND+receivedate:{date_range}\"\r\n\r\n        result = fda.query(\"drug\", \"event\", search=search, limit=1)\r\n        count = result[\"meta\"][\"results\"][\"total\"] if \"meta\" in result else 0\r\n\r\n        trends.append({\r\n            \"month\": start.strftime(\"%Y-%m\"),\r\n            \"events\": count\r\n        })\r\n\r\n    return trends\r\n```\r\n\r\n### Pattern 3: Comparative Analysis\r\n\r\nCompare multiple products side-by-side:\r\n\r\n```python\r\ndef compare_drugs(fda, drug_list):\r\n    \"\"\"Compare safety profiles of multiple drugs.\"\"\"\r\n    comparison = {}\r\n\r\n    for drug in drug_list:\r\n        # Total events\r\n        events = fda.query_drug_events(drug, limit=1)\r\n        total = events[\"meta\"][\"results\"][\"total\"] if \"meta\" in events else 0\r\n\r\n        # Serious events\r\n        serious = fda.query(\"drug\", \"event\",\r\n            search=f\"patient.drug.medicinalproduct:*{drug}*+AND+serious:1\",\r\n            limit=1)\r\n        serious_count = serious[\"meta\"][\"results\"][\"total\"] if \"meta\" in serious else 0\r\n\r\n        comparison[drug] = {\r\n            \"total_events\": total,\r\n            \"serious_events\": serious_count,\r\n            \"serious_rate\": (serious_count/total*100) if total > 0 else 0\r\n        }\r\n\r\n    return comparison\r\n```\r\n\r\n### Pattern 4: Cross-Database Lookup\r\n\r\nLink data across multiple endpoints:\r\n\r\n```python\r\ndef comprehensive_device_lookup(fda, device_name):\r\n    \"\"\"Look up device across all relevant databases.\"\"\"\r\n\r\n    return {\r\n        \"adverse_events\": fda.query_device_events(device_name, limit=10),\r\n        \"510k_clearances\": fda.query_device_510k(device_name=device_name),\r\n        \"recalls\": fda.query(\"device\", \"enforcement\",\r\n                           search=f\"product_description:*{device_name}*\"),\r\n        \"udi_info\": fda.query(\"device\", \"udi\",\r\n                            search=f\"brand_name:*{device_name}*\")\r\n    }\r\n```",
    "Scripts": "### `scripts/fda_query.py`\r\n\r\nMain query module with `FDAQuery` class providing:\r\n- Unified interface to all FDA endpoints\r\n- Automatic rate limiting and caching\r\n- Error handling and retry logic\r\n- Common query patterns\r\n\r\n### `scripts/fda_examples.py`\r\n\r\nComprehensive examples demonstrating:\r\n- Drug safety profile analysis\r\n- Device surveillance monitoring\r\n- Food recall tracking\r\n- Substance lookup\r\n- Comparative drug analysis\r\n- Veterinary drug analysis\r\n\r\nRun examples:\r\n```bash\r\npython scripts/fda_examples.py\r\n```"
  }
}
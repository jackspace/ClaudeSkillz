{
  "description": "|",
  "metadata": {
    "license": "MIT"
  },
  "references": {
    "files": [
      "references/api-reference.md",
      "references/direct-upload-complete-workflow.md",
      "references/format-optimization.md",
      "references/responsive-images-patterns.md",
      "references/signed-urls-guide.md",
      "references/top-errors.md",
      "references/transformation-options.md",
      "references/variants-guide.md"
    ]
  },
  "content": "**Status**: Production Ready ✅\r\n**Last Updated**: 2025-10-26\r\n**Dependencies**: Cloudflare account with Images enabled\r\n**Latest Versions**: Cloudflare Images API v2\r\n\r\n---\r\n\r\n\r\n### Templates (templates/)\r\n\r\nCopy-paste ready code for common patterns:\r\n\r\n1. **wrangler-images-binding.jsonc** - Wrangler configuration (no binding needed)\r\n2. **upload-api-basic.ts** - Upload file to Images API\r\n3. **upload-via-url.ts** - Ingest image from external URL\r\n4. **direct-creator-upload-backend.ts** - Generate one-time upload URLs\r\n5. **direct-creator-upload-frontend.html** - User upload form\r\n6. **transform-via-url.ts** - URL transformation examples\r\n7. **transform-via-workers.ts** - Workers transformation patterns\r\n8. **variants-management.ts** - Create/list/delete variants\r\n9. **signed-urls-generation.ts** - HMAC-SHA256 signed URL generation\r\n10. **responsive-images-srcset.html** - Responsive image patterns\r\n11. **batch-upload.ts** - Batch API for high-volume uploads\r\n\r\n**Usage**:\r\n```bash\r\ncp templates/upload-api-basic.ts src/upload.ts\r\n\r\n### Custom Domains\r\n\r\nServe images from your own domain instead of `imagedelivery.net`.\r\n\r\n**URL Format**:\r\n```\r\nhttps://example.com/cdn-cgi/imagedelivery/<ACCOUNT_HASH>/<IMAGE_ID>/<VARIANT>\r\n```\r\n\r\n**Requirements**:\r\n- Domain must be on Cloudflare (same account as Images)\r\n- Proxied through Cloudflare (orange cloud)\r\n\r\n**Custom Paths** (Transform Rules):\r\n\r\nRewrite `/images/...` to `/cdn-cgi/imagedelivery/...`:\r\n\r\n1. Dashboard → Rules → Transform Rules → Rewrite URL\r\n2. Match: `starts_with(http.request.uri.path, \"/images/\")`\r\n3. Rewrite: `/cdn-cgi/imagedelivery/<ACCOUNT_HASH>${substring(http.request.uri.path, 7)}`\r\n\r\nNow `/images/{id}/{variant}` → `/cdn-cgi/imagedelivery/{hash}/{id}/{variant}`\r\n\r\n**See**: [Serve images from custom domains](https://developers.cloudflare.com/images/manage-images/serve-images/serve-from-custom-domains/)\r\n\r\n### Batch API\r\n\r\nHigh-volume uploads with batch tokens.\r\n\r\n**Host**: `batch.imagedelivery.net` (instead of `api.cloudflare.com`)\r\n\r\n**Usage**:\r\n```bash",
  "name": "cloudflare-images",
  "id": "cloudflare-images",
  "sections": {
    "Quick Start (5 Minutes)": "### 1. Enable Cloudflare Images\r\n\r\nLog into Cloudflare dashboard → **Images** → Enable for your account.\r\n\r\nGet your Account ID and create an API token with **Cloudflare Images: Edit** permissions.\r\n\r\n**Why this matters:**\r\n- Account ID and API token are required for all API operations\r\n- Images Free plan includes limited transformations\r\n\r\n### 2. Upload Your First Image\r\n\r\n```bash\r\ncurl --request POST \\\r\n  --url https://api.cloudflare.com/client/v4/accounts/<ACCOUNT_ID>/images/v1 \\\r\n  --header 'Authorization: Bearer <API_TOKEN>' \\\r\n  --header 'Content-Type: multipart/form-data' \\\r\n  --form 'file=@./image.jpg'\r\n```\r\n\r\nResponse includes:\r\n- `id`: Image ID for serving\r\n- `variants`: Array of delivery URLs\r\n\r\n**CRITICAL:**\r\n- Use `multipart/form-data` encoding (NOT `application/json`)\r\n- Image ID is automatically generated (or use custom ID)\r\n\r\n### 3. Serve the Image\r\n\r\n```html\r\n<img src=\"https://imagedelivery.net/<ACCOUNT_HASH>/<IMAGE_ID>/public\" />\r\n```\r\n\r\nDefault `public` variant serves the image. Replace with your own variant names.\r\n\r\n### 4. Enable Image Transformations\r\n\r\nDashboard → **Images** → **Transformations** → Select your zone → **Enable for zone**\r\n\r\nNow you can transform ANY image:\r\n\r\n```html\r\n<img src=\"/cdn-cgi/image/width=800,quality=85/uploads/photo.jpg\" />\r\n```\r\n\r\n**Why this matters:**\r\n- Works on images stored OUTSIDE Cloudflare Images\r\n- Automatic caching on Cloudflare's global network\r\n- No additional storage costs\r\n\r\n### 5. Transform via Workers (Advanced)\r\n\r\n```typescript\r\nexport default {\r\n  async fetch(request: Request): Promise<Response> {\r\n    const imageURL = \"https://example.com/image.jpg\";\r\n\r\n    return fetch(imageURL, {\r\n      cf: {\r\n        image: {\r\n          width: 800,\r\n          quality: 85,\r\n          format: \"auto\" // WebP/AVIF for supporting browsers\r\n        }\r\n      }\r\n    });\r\n  }\r\n};\r\n```\r\n\r\n---",
    "Known Issues Prevention": "This skill prevents **13+** documented issues.\r\n\r\n### Issue #1: Direct Creator Upload CORS Error\r\n\r\n**Error**: `Access to XMLHttpRequest blocked by CORS policy: Request header field content-type is not allowed`\r\n\r\n**Source**: [Cloudflare Community #345739](https://community.cloudflare.com/t/direct-image-upload-cors-error/345739), [#368114](https://community.cloudflare.com/t/cloudflare-images-direct-upload-cors-problem/368114)\r\n\r\n**Why It Happens**: Server CORS settings only allow `multipart/form-data` for Content-Type header\r\n\r\n**Prevention**:\r\n```javascript\r\n// ✅ CORRECT\r\nconst formData = new FormData();\r\nformData.append('file', fileInput.files[0]);\r\nawait fetch(uploadURL, {\r\n  method: 'POST',\r\n  body: formData // Browser sets multipart/form-data automatically\r\n});\r\n\r\n// ❌ WRONG\r\nawait fetch(uploadURL, {\r\n  method: 'POST',\r\n  headers: { 'Content-Type': 'application/json' }, // CORS error\r\n  body: JSON.stringify({ file: base64Image })\r\n});\r\n```\r\n\r\n### Issue #2: Error 5408 - Upload Timeout\r\n\r\n**Error**: `Error 5408` after ~15 seconds of upload\r\n\r\n**Source**: [Cloudflare Community #571336](https://community.cloudflare.com/t/images-direct-creator-upload-error-5408/571336)\r\n\r\n**Why It Happens**: Cloudflare has 30-second request timeout; slow uploads or large files exceed limit\r\n\r\n**Prevention**:\r\n- Compress images before upload (client-side with Canvas API)\r\n- Use reasonable file size limits (e.g., max 10MB)\r\n- Show upload progress to user\r\n- Handle timeout errors gracefully\r\n\r\n```javascript\r\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\r\n\r\nif (file.size > MAX_FILE_SIZE) {\r\n  alert('File too large. Please select an image under 10MB.');\r\n  return;\r\n}\r\n```\r\n\r\n### Issue #3: Error 400 - Invalid File Parameter\r\n\r\n**Error**: `400 Bad Request` with unhelpful error message\r\n\r\n**Source**: [Cloudflare Community #487629](https://community.cloudflare.com/t/direct-creator-upload-returning-400/487629)\r\n\r\n**Why It Happens**: File field must be named `file` (not `image`, `photo`, etc.)\r\n\r\n**Prevention**:\r\n```javascript\r\n// ✅ CORRECT\r\nformData.append('file', imageFile);\r\n\r\n// ❌ WRONG\r\nformData.append('image', imageFile); // 400 error\r\nformData.append('photo', imageFile); // 400 error\r\n```\r\n\r\n### Issue #4: CORS Preflight Failures\r\n\r\n**Error**: Preflight OPTIONS request blocked\r\n\r\n**Source**: [Cloudflare Community #306805](https://community.cloudflare.com/t/cors-error-when-using-direct-creator-upload/306805)\r\n\r\n**Why It Happens**: Calling `/direct_upload` API directly from browser (should be backend-only)\r\n\r\n**Prevention**:\r\n```\r\nARCHITECTURE:\r\nBrowser → Backend API → POST /direct_upload → Returns uploadURL → Browser uploads to uploadURL\r\n```\r\n\r\nNever expose API token to browser. Generate upload URL on backend, return to frontend.\r\n\r\n### Issue #5: Error 9401 - Invalid Arguments\r\n\r\n**Error**: `Cf-Resized: err=9401` - Required cf.image options missing or invalid\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Missing required transformation parameters or invalid values\r\n\r\n**Prevention**:\r\n```typescript\r\n// ✅ CORRECT\r\nfetch(imageURL, {\r\n  cf: {\r\n    image: {\r\n      width: 800,\r\n      quality: 85,\r\n      format: 'auto'\r\n    }\r\n  }\r\n});\r\n\r\n// ❌ WRONG\r\nfetch(imageURL, {\r\n  cf: {\r\n    image: {\r\n      width: 'large', // Must be number\r\n      quality: 150 // Max 100\r\n    }\r\n  }\r\n});\r\n```\r\n\r\n### Issue #6: Error 9402 - Image Too Large\r\n\r\n**Error**: `Cf-Resized: err=9402` - Image too large or connection interrupted\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Image exceeds maximum area (100 megapixels) or download fails\r\n\r\n**Prevention**:\r\n- Validate image dimensions before transforming\r\n- Use reasonable source images (max 10000x10000px)\r\n- Handle network errors gracefully\r\n\r\n### Issue #7: Error 9403 - Request Loop\r\n\r\n**Error**: `Cf-Resized: err=9403` - Worker fetching its own URL or already-resized image\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Transformation applied to already-transformed image, or Worker fetches itself\r\n\r\n**Prevention**:\r\n```typescript\r\n// ✅ CORRECT\r\nif (url.pathname.startsWith('/images/')) {\r\n  const originalPath = url.pathname.replace('/images/', '');\r\n  const originURL = `https://storage.example.com/${originalPath}`;\r\n  return fetch(originURL, { cf: { image: { width: 800 } } });\r\n}\r\n\r\n// ❌ WRONG\r\nif (url.pathname.startsWith('/images/')) {\r\n  // Fetches worker's own URL, causes loop\r\n  return fetch(request, { cf: { image: { width: 800 } } });\r\n}\r\n```\r\n\r\n### Issue #8: Error 9406/9419 - Invalid URL Format\r\n\r\n**Error**: `Cf-Resized: err=9406` or `err=9419` - Non-HTTPS URL or URL has spaces/unescaped Unicode\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Image URL uses HTTP (not HTTPS) or contains invalid characters\r\n\r\n**Prevention**:\r\n```typescript\r\n// ✅ CORRECT\r\nconst imageURL = \"https://example.com/images/photo%20name.jpg\";\r\n\r\n// ❌ WRONG\r\nconst imageURL = \"http://example.com/images/photo.jpg\"; // HTTP not allowed\r\nconst imageURL = \"https://example.com/images/photo name.jpg\"; // Space not encoded\r\n```\r\n\r\nAlways use `encodeURIComponent()` for URL paths:\r\n```typescript\r\nconst filename = \"photo name.jpg\";\r\nconst imageURL = `https://example.com/images/${encodeURIComponent(filename)}`;\r\n```\r\n\r\n### Issue #9: Error 9412 - Non-Image Response\r\n\r\n**Error**: `Cf-Resized: err=9412` - Origin returned HTML instead of image\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Origin server returns 404 page or error page (HTML) instead of image\r\n\r\n**Prevention**:\r\n```typescript\r\n// Verify URL before transforming\r\nconst originResponse = await fetch(imageURL, { method: 'HEAD' });\r\nconst contentType = originResponse.headers.get('content-type');\r\n\r\nif (!contentType?.startsWith('image/')) {\r\n  return new Response('Not an image', { status: 400 });\r\n}\r\n\r\nreturn fetch(imageURL, { cf: { image: { width: 800 } } });\r\n```\r\n\r\n### Issue #10: Error 9413 - Max Image Area Exceeded\r\n\r\n**Error**: `Cf-Resized: err=9413` - Image exceeds 100 megapixels\r\n\r\n**Source**: [Cloudflare Images Docs - Troubleshooting](https://developers.cloudflare.com/images/reference/troubleshooting/)\r\n\r\n**Why It Happens**: Source image dimensions exceed 100 megapixels (e.g., 10000x10000px)\r\n\r\n**Prevention**:\r\n- Validate image dimensions before upload\r\n- Pre-process oversized images\r\n- Reject images above threshold\r\n\r\n```typescript\r\nconst MAX_MEGAPIXELS = 100;\r\n\r\nif (width * height > MAX_MEGAPIXELS * 1_000_000) {\r\n  return new Response('Image too large', { status: 413 });\r\n}\r\n```\r\n\r\n### Issue #11: Flexible Variants + Signed URLs Incompatibility\r\n\r\n**Error**: Flexible variants don't work with private images\r\n\r\n**Source**: [Cloudflare Images Docs - Enable flexible variants](https://developers.cloudflare.com/images/manage-images/enable-flexible-variants/)\r\n\r\n**Why It Happens**: Flexible variants cannot be used with `requireSignedURLs=true`\r\n\r\n**Prevention**:\r\n```typescript\r\n// ✅ CORRECT - Use named variants for private images\r\nawait uploadImage({\r\n  file: imageFile,\r\n  requireSignedURLs: true // Use named variants: /public, /avatar, etc.\r\n});\r\n\r\n// ❌ WRONG - Flexible variants don't support signed URLs\r\n// Cannot use: /w=400,sharpen=3 with requireSignedURLs=true\r\n```\r\n\r\n### Issue #12: SVG Resizing Limitation\r\n\r\n**Error**: SVG files don't resize via transformations\r\n\r\n**Source**: [Cloudflare Images Docs - SVG files](https://developers.cloudflare.com/images/transform-images/#svg-files)\r\n\r\n**Why It Happens**: SVG is inherently scalable (vector format), resizing not applicable\r\n\r\n**Prevention**:\r\n```typescript\r\n// SVGs can be served but not resized\r\n// Use any variant name as placeholder\r\n// https://imagedelivery.net/<HASH>/<SVG_ID>/public\r\n\r\n// SVG will be served at original size regardless of variant settings\r\n```\r\n\r\n### Issue #13: EXIF Metadata Stripped by Default\r\n\r\n**Error**: GPS data, camera settings removed from uploaded JPEGs\r\n\r\n**Source**: [Cloudflare Images Docs - Transform via URL](https://developers.cloudflare.com/images/transform-images/transform-via-url/#metadata)\r\n\r\n**Why It Happens**: Default behavior strips all metadata except copyright\r\n\r\n**Prevention**:\r\n```typescript\r\n// Preserve metadata\r\nfetch(imageURL, {\r\n  cf: {\r\n    image: {\r\n      width: 800,\r\n      metadata: 'keep' // Options: 'none', 'copyright', 'keep'\r\n    }\r\n  }\r\n});\r\n```\r\n\r\n**Options**:\r\n- `none`: Strip all metadata\r\n- `copyright`: Keep only copyright tag (default for JPEG)\r\n- `keep`: Preserve most EXIF metadata including GPS\r\n\r\n---",
    "Overview": "Cloudflare Images provides two powerful features:\r\n\r\n1. **Images API**: Upload, store, and serve images with automatic optimization and variants\r\n2. **Image Transformations**: Resize, optimize, and transform any publicly accessible image\r\n\r\n**Key Benefits**:\r\n- Global CDN delivery\r\n- Automatic WebP/AVIF conversion\r\n- Variants for different use cases (up to 100)\r\n- Direct creator upload (user uploads without API keys)\r\n- Signed URLs for private images\r\n- Transform any image via URL or Workers\r\n\r\n---",
    "Image Transformations": "### URL Transformations\r\n\r\nTransform images using a special URL format.\r\n\r\n**URL Pattern**:\r\n```\r\nhttps://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>\r\n```\r\n\r\n**Example**:\r\n```html\r\n<img src=\"/cdn-cgi/image/width=800,quality=85,format=auto/uploads/photo.jpg\" />\r\n```\r\n\r\n**Common Options**:\r\n- **Sizing**: `width=800`, `height=600`, `fit=cover`\r\n- **Quality**: `quality=85` (1-100)\r\n- **Format**: `format=auto` (WebP/AVIF auto-detection), `format=webp`, `format=jpeg`\r\n- **Cropping**: `gravity=auto` (smart crop), `gravity=face`, `trim=10`\r\n- **Effects**: `blur=10`, `sharpen=3`, `brightness=1.2`, `contrast=1.1`\r\n- **Rotation**: `rotate=90`, `flip=h` (horizontal), `flip=v` (vertical)\r\n\r\n**Fit Options**:\r\n- `scale-down`: Shrink to fit (never enlarge)\r\n- `contain`: Resize to fit within dimensions (preserve aspect ratio)\r\n- `cover`: Resize to fill dimensions (may crop)\r\n- `crop`: Crop to exact dimensions\r\n- `pad`: Resize and add padding (use with `background` option)\r\n\r\n**Format Auto-Detection**:\r\n```html\r\n<img src=\"/cdn-cgi/image/format=auto/image.jpg\" />\r\n```\r\n\r\nCloudflare serves:\r\n- AVIF to browsers that support it (Chrome, Edge)\r\n- WebP to browsers without AVIF support (Safari, Firefox)\r\n- Original format (JPEG) as fallback\r\n\r\n**See**: `templates/transform-via-url.ts`, `references/transformation-options.md`\r\n\r\n### Workers Transformations\r\n\r\nProgrammatic image transformations with custom URL schemes.\r\n\r\n**Basic Pattern**:\r\n```typescript\r\nexport default {\r\n  async fetch(request: Request): Promise<Response> {\r\n    const url = new URL(request.url);\r\n\r\n    // Custom URL scheme: /images/thumbnail/photo.jpg\r\n    if (url.pathname.startsWith('/images/thumbnail/')) {\r\n      const imagePath = url.pathname.replace('/images/thumbnail/', '');\r\n      const imageURL = `https://storage.example.com/${imagePath}`;\r\n\r\n      return fetch(imageURL, {\r\n        cf: {\r\n          image: {\r\n            width: 300,\r\n            height: 300,\r\n            fit: 'cover',\r\n            quality: 85\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    return new Response('Not found', { status: 404 });\r\n  }\r\n};\r\n```\r\n\r\n**Advanced: Content Negotiation**:\r\n```typescript\r\nconst accept = request.headers.get('accept') || '';\r\n\r\nlet format: 'avif' | 'webp' | 'auto' = 'auto';\r\nif (/image\\/avif/.test(accept)) {\r\n  format = 'avif';\r\n} else if (/image\\/webp/.test(accept)) {\r\n  format = 'webp';\r\n}\r\n\r\nreturn fetch(imageURL, {\r\n  cf: {\r\n    image: {\r\n      format,\r\n      width: 800,\r\n      quality: 85\r\n    }\r\n  }\r\n});\r\n```\r\n\r\n**Why Workers Transformations:**\r\n- **Custom URL schemes**: Hide image storage location\r\n- **Preset names**: Use `thumbnail`, `avatar`, `large` instead of pixel values\r\n- **Content negotiation**: Serve optimal format based on browser\r\n- **Access control**: Check authentication before serving\r\n- **Dynamic sizing**: Calculate dimensions based on device type\r\n\r\n**See**: `templates/transform-via-workers.ts`, `references/transformation-options.md`\r\n\r\n---",
    "Package Versions (Verified 2025-10-26)": "**API Version**: v2 (for direct uploads), v1 (for standard uploads)\r\n\r\n**No npm packages required** - uses native Cloudflare APIs\r\n\r\n**Optional**:\r\n- `@cloudflare/workers-types@latest` - TypeScript types for Workers\r\n\r\n---\r\n\r\n**Questions? Issues?**\r\n\r\n1. Check `references/top-errors.md` for common issues\r\n2. Verify all steps in the setup process\r\n3. Check official docs: https://developers.cloudflare.com/images/\r\n4. Ensure transformations are enabled on zone\r\n5. Verify CORS setup for Direct Creator Upload",
    "Responsive Images": "Serve optimal image sizes for different screen sizes.\r\n\r\n**Using Named Variants**:\r\n```html\r\n<img\r\n  srcset=\"\r\n    https://imagedelivery.net/<HASH>/<ID>/mobile 480w,\r\n    https://imagedelivery.net/<HASH>/<ID>/tablet 768w,\r\n    https://imagedelivery.net/<HASH>/<ID>/desktop 1920w\r\n  \"\r\n  sizes=\"(max-width: 480px) 480px, (max-width: 768px) 768px, 1920px\"\r\n  src=\"https://imagedelivery.net/<HASH>/<ID>/desktop\"\r\n  alt=\"Responsive image\"\r\n/>\r\n```\r\n\r\n**Using Flexible Variants**:\r\n```html\r\n<img\r\n  srcset=\"\r\n    https://imagedelivery.net/<HASH>/<ID>/w=480,f=auto 480w,\r\n    https://imagedelivery.net/<HASH>/<ID>/w=768,f=auto 768w,\r\n    https://imagedelivery.net/<HASH>/<ID>/w=1920,f=auto 1920w\r\n  \"\r\n  sizes=\"(max-width: 480px) 480px, (max-width: 768px) 768px, 1920px\"\r\n  src=\"https://imagedelivery.net/<HASH>/<ID>/w=1920,f=auto\"\r\n  alt=\"Responsive image\"\r\n/>\r\n```\r\n\r\n**Art Direction** (different crops for mobile vs desktop):\r\n```html\r\n<picture>\r\n  <source\r\n    media=\"(max-width: 767px)\"\r\n    srcset=\"https://imagedelivery.net/<HASH>/<ID>/mobile-square\"\r\n  />\r\n  <source\r\n    media=\"(min-width: 768px)\"\r\n    srcset=\"https://imagedelivery.net/<HASH>/<ID>/desktop-wide\"\r\n  />\r\n  <img src=\"https://imagedelivery.net/<HASH>/<ID>/desktop-wide\" alt=\"Hero image\" />\r\n</picture>\r\n```\r\n\r\n**See**: `templates/responsive-images-srcset.html`, `references/responsive-images-patterns.md`\r\n\r\n---",
    "Images API - Upload Methods": "### Method 1: File Upload (Basic)\r\n\r\n```bash\r\ncurl --request POST \\\r\n  https://api.cloudflare.com/client/v4/accounts/{account_id}/images/v1 \\\r\n  --header \"Authorization: Bearer <API_TOKEN>\" \\\r\n  --header \"Content-Type: multipart/form-data\" \\\r\n  --form 'file=@./image.jpg' \\\r\n  --form 'requireSignedURLs=false' \\\r\n  --form 'metadata={\"key\":\"value\"}'\r\n```\r\n\r\n**Key Options**:\r\n- `file`: Image file (required)\r\n- `id`: Custom ID (optional, default auto-generated)\r\n- `requireSignedURLs`: `true` for private images (default: `false`)\r\n- `metadata`: JSON object (max 1024 bytes, not visible to end users)\r\n\r\n**Response**:\r\n```json\r\n{\r\n  \"result\": {\r\n    \"id\": \"2cdc28f0-017a-49c4-9ed7-87056c83901\",\r\n    \"filename\": \"image.jpg\",\r\n    \"uploaded\": \"2022-01-31T16:39:28.458Z\",\r\n    \"requireSignedURLs\": false,\r\n    \"variants\": [\r\n      \"https://imagedelivery.net/Vi7wi5KSItxGFsWRG2Us6Q/2cdc28f0.../public\"\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n**See**: `templates/upload-api-basic.ts`\r\n\r\n### Method 2: Upload via URL\r\n\r\nIngest images from external sources without downloading first.\r\n\r\n```bash\r\ncurl --request POST \\\r\n  https://api.cloudflare.com/client/v4/accounts/{account_id}/images/v1 \\\r\n  --header \"Authorization: Bearer <API_TOKEN>\" \\\r\n  --form 'url=https://example.com/image.jpg' \\\r\n  --form 'metadata={\"source\":\"external\"}'\r\n```\r\n\r\n**When to use**:\r\n- Migrating images from another service\r\n- Ingesting user-provided URLs\r\n- Backing up images from external sources\r\n\r\n**CRITICAL:**\r\n- URL must be publicly accessible or authenticated\r\n- Supports HTTP basic auth: `https://user:password@example.com/image.jpg`\r\n- Cannot use both `file` and `url` in same request\r\n\r\n**See**: `templates/upload-via-url.ts`\r\n\r\n### Method 3: Direct Creator Upload ⭐\r\n\r\nGenerate one-time upload URLs for users to upload directly to Cloudflare (no API key exposure).\r\n\r\n**Backend Endpoint** (generate upload URL):\r\n```typescript\r\nconst response = await fetch(\r\n  `https://api.cloudflare.com/client/v4/accounts/${accountId}/images/v2/direct_upload`,\r\n  {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${apiToken}`,\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      requireSignedURLs: true,\r\n      metadata: { userId: '12345' },\r\n      expiry: '2025-10-26T18:00:00Z' // Optional: default 30min, max 6hr\r\n    })\r\n  }\r\n);\r\n\r\nconst { uploadURL, id } = await response.json();\r\n// Return uploadURL to frontend\r\n```\r\n\r\n**Frontend Upload** (HTML + JavaScript):\r\n```html\r\n<form id=\"upload-form\">\r\n  <input type=\"file\" id=\"file-input\" accept=\"image/*\" />\r\n  <button type=\"submit\">Upload</button>\r\n</form>\r\n\r\n<script>\r\ndocument.getElementById('upload-form').addEventListener('submit', async (e) => {\r\n  e.preventDefault();\r\n\r\n  const fileInput = document.getElementById('file-input');\r\n  const formData = new FormData();\r\n  formData.append('file', fileInput.files[0]); // MUST be named 'file'\r\n\r\n  const uploadURL = 'UPLOAD_URL_FROM_BACKEND'; // Get from backend\r\n\r\n  const response = await fetch(uploadURL, {\r\n    method: 'POST',\r\n    body: formData // NO Content-Type header, browser sets multipart/form-data\r\n  });\r\n\r\n  if (response.ok) {\r\n    console.log('Upload successful!');\r\n  }\r\n});\r\n</script>\r\n```\r\n\r\n**Why this matters:**\r\n- No API key exposure to browser\r\n- Users upload directly to Cloudflare (faster, no intermediary server)\r\n- One-time URL expires after use or timeout\r\n- Webhooks available for upload success/failure notifications\r\n\r\n**CRITICAL CORS FIX**:\r\n- ✅ **DO**: Use `multipart/form-data` encoding (let browser set header)\r\n- ✅ **DO**: Name field `file` (NOT `image` or other names)\r\n- ✅ **DO**: Call `/direct_upload` API from backend only\r\n- ❌ **DON'T**: Set `Content-Type: application/json` or `image/jpeg`\r\n- ❌ **DON'T**: Call `/direct_upload` from browser (CORS will fail)\r\n\r\n**See**: `templates/direct-creator-upload-backend.ts`, `templates/direct-creator-upload-frontend.html`, `references/direct-upload-complete-workflow.md`\r\n\r\n---",
    "Variants Management": "### Named Variants (Up to 100)\r\n\r\nCreate predefined transformations for different use cases.\r\n\r\n**Create via API**:\r\n```bash\r\ncurl \"https://api.cloudflare.com/client/v4/accounts/{account_id}/images/v1/variants\" \\\r\n  --header \"Authorization: Bearer <API_TOKEN>\" \\\r\n  --header \"Content-Type: application/json\" \\\r\n  --data '{\r\n    \"id\": \"avatar\",\r\n    \"options\": {\r\n      \"fit\": \"cover\",\r\n      \"width\": 200,\r\n      \"height\": 200,\r\n      \"metadata\": \"none\"\r\n    },\r\n    \"neverRequireSignedURLs\": false\r\n  }'\r\n```\r\n\r\n**Use in URLs**:\r\n```html\r\n<img src=\"https://imagedelivery.net/<ACCOUNT_HASH>/<IMAGE_ID>/avatar\" />\r\n```\r\n\r\n**When to use**:\r\n- Consistent image sizes across your app\r\n- Private images (works with signed URLs)\r\n- Simple, predictable URLs\r\n\r\n**See**: `templates/variants-management.ts`\r\n\r\n### Flexible Variants\r\n\r\nDynamic transformations using params in URL.\r\n\r\n**Enable** (per account, one-time):\r\n```bash\r\ncurl --request PATCH \\\r\n  https://api.cloudflare.com/client/v4/accounts/{account_id}/images/v1/config \\\r\n  --header \"Authorization: Bearer <API_TOKEN>\" \\\r\n  --header \"Content-Type: application/json\" \\\r\n  --data '{\"flexible_variants\": true}'\r\n```\r\n\r\n**Use in URLs**:\r\n```html\r\n<img src=\"https://imagedelivery.net/<ACCOUNT_HASH>/<IMAGE_ID>/w=400,sharpen=3\" />\r\n```\r\n\r\n**When to use**:\r\n- Dynamic sizing needs\r\n- Public images only (cannot use with signed URLs)\r\n- Rapid prototyping\r\n\r\n**CRITICAL:**\r\n- ❌ **Cannot use with `requireSignedURLs=true`**\r\n- ✅ **Use named variants for private images**\r\n\r\n**See**: `references/variants-guide.md`\r\n\r\n---",
    "Signed URLs (Private Images)": "Generate time-limited URLs for private images using HMAC-SHA256 tokens.\r\n\r\n**URL Format**:\r\n```\r\nhttps://imagedelivery.net/<ACCOUNT_HASH>/<IMAGE_ID>/<VARIANT>?exp=<EXPIRY>&sig=<SIGNATURE>\r\n```\r\n\r\n**Generate Signature** (Workers example):\r\n```typescript\r\nasync function generateSignedURL(\r\n  imageId: string,\r\n  variant: string,\r\n  expirySeconds: number = 3600\r\n): Promise<string> {\r\n  const accountHash = 'YOUR_ACCOUNT_HASH';\r\n  const signingKey = 'YOUR_SIGNING_KEY'; // Dashboard → Images → Keys\r\n\r\n  const expiry = Math.floor(Date.now() / 1000) + expirySeconds;\r\n  const stringToSign = `${imageId}${variant}${expiry}`;\r\n\r\n  const encoder = new TextEncoder();\r\n  const keyData = encoder.encode(signingKey);\r\n  const messageData = encoder.encode(stringToSign);\r\n\r\n  const cryptoKey = await crypto.subtle.importKey(\r\n    'raw',\r\n    keyData,\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  );\r\n\r\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);\r\n  const sig = Array.from(new Uint8Array(signature))\r\n    .map(b => b.toString(16).padStart(2, '0'))\r\n    .join('');\r\n\r\n  return `https://imagedelivery.net/${accountHash}/${imageId}/${variant}?exp=${expiry}&sig=${sig}`;\r\n}\r\n```\r\n\r\n**Usage**:\r\n```typescript\r\nconst signedURL = await generateSignedURL('image-id', 'public', 3600);\r\n// Returns URL valid for 1 hour\r\n```\r\n\r\n**When to use**:\r\n- User profile photos (private until shared)\r\n- Paid content (time-limited access)\r\n- Temporary downloads\r\n- Secure image delivery\r\n\r\n**See**: `templates/signed-urls-generation.ts`, `references/signed-urls-guide.md`\r\n\r\n---",
    "Critical Rules": "### Always Do\r\n\r\n✅ Use `multipart/form-data` for Direct Creator Upload\r\n✅ Name the file field `file` (not `image` or other names)\r\n✅ Call `/direct_upload` API from backend only (NOT browser)\r\n✅ Use HTTPS URLs for transformations (HTTP not supported)\r\n✅ URL-encode special characters in image paths\r\n✅ Enable transformations on zone before using `/cdn-cgi/image/`\r\n✅ Use named variants for private images (signed URLs)\r\n✅ Check `Cf-Resized` header for transformation errors\r\n✅ Set `format=auto` for automatic WebP/AVIF conversion\r\n✅ Use `fit=scale-down` to prevent unwanted enlargement\r\n\r\n### Never Do\r\n\r\n❌ Use `application/json` Content-Type for file uploads\r\n❌ Call `/direct_upload` from browser (CORS will fail)\r\n❌ Use flexible variants with `requireSignedURLs=true`\r\n❌ Resize SVG files (they're inherently scalable)\r\n❌ Use HTTP URLs for transformations (HTTPS only)\r\n❌ Put spaces or unescaped Unicode in URLs\r\n❌ Transform the same image multiple times in Workers (causes 9403 loop)\r\n❌ Exceed 100 megapixels image size\r\n❌ Use `/cdn-cgi/image/` endpoint in Workers (use `cf.image` instead)\r\n❌ Forget to enable transformations on zone before use\r\n\r\n---",
    "Advanced Topics": "curl \"https://batch.imagedelivery.net/images/v1\" \\\r\n  --header \"Authorization: Bearer <BATCH_TOKEN>\" \\\r\n  --form 'file=@./image.jpg'\r\n```\r\n\r\n**When to use**:\r\n- Migrating thousands of images\r\n- Bulk upload workflows\r\n- Automated image ingestion\r\n\r\n**See**: `templates/batch-upload.ts`\r\n\r\n### Webhooks\r\n\r\nReceive notifications for upload success/failure (Direct Creator Upload only).\r\n\r\n**Setup**:\r\n1. Dashboard → Notifications → Destinations → Webhooks → Create\r\n2. Enter webhook URL and test\r\n3. Notifications → All Notifications → Add → Images → Select webhook\r\n\r\n**Payload** (example):\r\n```json\r\n{\r\n  \"imageId\": \"2cdc28f0-017a-49c4-9ed7-87056c83901\",\r\n  \"status\": \"uploaded\",\r\n  \"metadata\": {\"userId\": \"12345\"}\r\n}\r\n```\r\n\r\n**When to use**:\r\n- Update database after upload\r\n- Trigger image processing pipeline\r\n- Notify user of upload status\r\n\r\n**See**: [Configure webhooks](https://developers.cloudflare.com/images/manage-images/configure-webhooks/)\r\n\r\n---",
    "Complete Setup Checklist": "- [ ] Cloudflare account with Images enabled\r\n- [ ] Account ID and API token obtained (Images: Edit permission)\r\n- [ ] (Optional) Image transformations enabled on zone\r\n- [ ] (Optional) Variants created for common use cases\r\n- [ ] (Optional) Flexible variants enabled if dynamic sizing needed\r\n- [ ] (Optional) Signing key obtained for private images\r\n- [ ] (Optional) Webhooks configured for upload notifications\r\n- [ ] (Optional) Custom domain configured with Transform Rules\r\n- [ ] Upload method implemented (file, URL, or direct creator)\r\n- [ ] Serving URLs tested (imagedelivery.net or custom domain)\r\n- [ ] Transformations tested (URL or Workers)\r\n- [ ] Error handling implemented (CORS, timeouts, size limits)\r\n\r\n---",
    "The 3-Feature System": "### Feature 1: Images API (Upload & Storage)\r\n\r\nStore images on Cloudflare's network and serve them globally.\r\n\r\n**Upload Methods**:\r\n1. **File Upload** - Upload files directly from your server\r\n2. **Upload via URL** - Ingest images from external URLs\r\n3. **Direct Creator Upload** - Generate one-time upload URLs for user uploads\r\n\r\n**Serving Options**:\r\n- Default domain: `imagedelivery.net`\r\n- Custom domains: `/cdn-cgi/imagedelivery/...`\r\n- Signed URLs: Private images with expiry tokens\r\n\r\n**See**: `templates/upload-api-basic.ts`, `templates/direct-creator-upload-backend.ts`\r\n\r\n### Feature 2: Image Transformations\r\n\r\nOptimize and resize ANY image (stored in Images or external).\r\n\r\n**Two Methods**:\r\n1. **URL Transformations** - Special URL format\r\n2. **Workers Transformations** - Programmatic control via fetch\r\n\r\n**Common Transformations**:\r\n- Resize: `width=800,height=600,fit=cover`\r\n- Optimize: `quality=85,format=auto`\r\n- Effects: `blur=10,sharpen=3`\r\n- Crop: `gravity=face,zoom=0.5`\r\n\r\n**See**: `templates/transform-via-url.ts`, `templates/transform-via-workers.ts`\r\n\r\n### Feature 3: Variants\r\n\r\nPredefined image sizes for different use cases.\r\n\r\n**Named Variants** (up to 100):\r\n- Create once, use everywhere\r\n- Example: `thumbnail`, `avatar`, `hero`\r\n- Consistent transformations\r\n\r\n**Flexible Variants** (dynamic):\r\n- Enable per account\r\n- Use transformation params in URL\r\n- Example: `w=400,sharpen=3`\r\n- **Cannot use with signed URLs**\r\n\r\n**See**: `templates/variants-management.ts`, `references/variants-guide.md`\r\n\r\n---",
    "Troubleshooting": "### Problem: Images not transforming\r\n\r\n**Symptoms**: `/cdn-cgi/image/...` returns original image or 404\r\n\r\n**Solutions**:\r\n1. Enable transformations on zone: Dashboard → Images → Transformations → Enable for zone\r\n2. Verify zone is proxied through Cloudflare (orange cloud)\r\n3. Check source image is publicly accessible\r\n4. Wait 5-10 minutes for settings to propagate\r\n\r\n### Problem: Direct upload returns CORS error\r\n\r\n**Symptoms**: `Access-Control-Allow-Origin` error in browser console\r\n\r\n**Solutions**:\r\n1. Use `multipart/form-data` encoding (let browser set Content-Type)\r\n2. Don't call `/direct_upload` from browser; call from backend\r\n3. Name file field `file` (not `image`)\r\n4. Remove manual Content-Type header\r\n\r\n### Problem: Worker transformations return 9403 loop error\r\n\r\n**Symptoms**: `Cf-Resized: err=9403` in response headers\r\n\r\n**Solutions**:\r\n1. Don't fetch Worker's own URL (use external origin)\r\n2. Don't transform already-resized images\r\n3. Check URL routing logic to avoid loops\r\n\r\n### Problem: Signed URLs not working\r\n\r\n**Symptoms**: 403 Forbidden when accessing signed URL\r\n\r\n**Solutions**:\r\n1. Verify image uploaded with `requireSignedURLs=true`\r\n2. Check signature generation (HMAC-SHA256)\r\n3. Ensure expiry timestamp is in future\r\n4. Verify signing key matches dashboard (Images → Keys)\r\n5. Cannot use flexible variants with signed URLs (use named variants)\r\n\r\n### Problem: Images uploaded but not appearing\r\n\r\n**Symptoms**: Upload returns 200 OK but image not in dashboard\r\n\r\n**Solutions**:\r\n1. Check for `draft: true` in response (Direct Creator Upload)\r\n2. Wait for upload to complete (check via GET `/images/v1/{id}`)\r\n3. Verify account ID matches\r\n4. Check for upload errors in webhooks\r\n\r\n---",
    "Official Documentation": "- **Cloudflare Images**: https://developers.cloudflare.com/images/\r\n- **Get Started**: https://developers.cloudflare.com/images/get-started/\r\n- **Upload Images**: https://developers.cloudflare.com/images/upload-images/\r\n- **Direct Creator Upload**: https://developers.cloudflare.com/images/upload-images/direct-creator-upload/\r\n- **Transform Images**: https://developers.cloudflare.com/images/transform-images/\r\n- **Transform via URL**: https://developers.cloudflare.com/images/transform-images/transform-via-url/\r\n- **Transform via Workers**: https://developers.cloudflare.com/images/transform-images/transform-via-workers/\r\n- **Create Variants**: https://developers.cloudflare.com/images/manage-images/create-variants/\r\n- **Serve Private Images**: https://developers.cloudflare.com/images/manage-images/serve-images/serve-private-images/\r\n- **Troubleshooting**: https://developers.cloudflare.com/images/reference/troubleshooting/\r\n- **API Reference**: https://developers.cloudflare.com/api/resources/images/\r\n\r\n---",
    "Using Bundled Resources": "```\r\n\r\n### References (references/)\r\n\r\nIn-depth documentation Claude can load as needed:\r\n\r\n1. **api-reference.md** - Complete API endpoints (upload, list, delete, variants)\r\n2. **transformation-options.md** - All transform params with examples\r\n3. **variants-guide.md** - Named vs flexible variants, when to use each\r\n4. **signed-urls-guide.md** - HMAC-SHA256 implementation details\r\n5. **direct-upload-complete-workflow.md** - Full architecture and flow\r\n6. **responsive-images-patterns.md** - srcset, sizes, art direction\r\n7. **format-optimization.md** - WebP/AVIF auto-conversion strategies\r\n8. **top-errors.md** - All 13+ errors with detailed troubleshooting\r\n\r\n**When to load**:\r\n- Deep-dive into specific feature\r\n- Troubleshooting complex issues\r\n- Understanding API details\r\n- Implementing advanced patterns\r\n\r\n### Scripts (scripts/)\r\n\r\n**check-versions.sh** - Verify API endpoints are current\r\n\r\n---"
  }
}
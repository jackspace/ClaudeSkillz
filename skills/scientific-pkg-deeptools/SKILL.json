{
  "description": "\"NGS analysis toolkit. BAM to bigWig conversion, QC (correlation, PCA, fingerprints), heatmaps/profiles (TSS, peaks), for ChIP-seq, RNA-seq, ATAC-seq visualization.\"",
  "references": {
    "files": [
      "references/effective_genome_sizes.md",
      "references/normalization_methods.md",
      "references/tools_reference.md",
      "references/workflows.md"
    ]
  },
  "content": "For users new to deepTools, start with file validation and common workflows:\r\n\r\n### 1. Validate Input Files\r\n\r\nBefore running any analysis, validate BAM, bigWig, and BED files using the validation script:\r\n\r\n```bash\r\npython scripts/validate_files.py --bam sample1.bam sample2.bam --bed regions.bed\r\n```\r\n\r\nThis checks file existence, BAM indices, and format correctness.\r\n\r\n### 2. Generate Workflow Template\r\n\r\nFor standard analyses, use the workflow generator to create customized scripts:\r\n\r\n```bash\r\npython scripts/workflow_generator.py --list\r\n\r\npython scripts/workflow_generator.py chipseq_qc -o qc_workflow.sh \\\r\n    --input-bam Input.bam --chip-bams \"ChIP1.bam ChIP2.bam\" \\\r\n    --genome-size 2913022398\r\n\r\n\r\nGuide users to install deepTools using conda (recommended):\r\n\r\n```bash\r\nconda install -c conda-forge -c bioconda deeptools\r\n\r\n\r\n### BAM/bigWig Processing\r\n\r\n**Convert BAM to normalized coverage:**\r\n```bash\r\nbamCoverage --bam input.bam --outFileName output.bw \\\r\n    --normalizeUsing RPGC --effectiveGenomeSize 2913022398 \\\r\n    --binSize 10 --numberOfProcessors 8\r\n```\r\n\r\n**Compare two samples (log2 ratio):**\r\n```bash\r\nbamCompare -b1 treatment.bam -b2 control.bam -o ratio.bw \\\r\n    --operation log2 --scaleFactorsMethod readCount\r\n```\r\n\r\n**Key tools:** bamCoverage, bamCompare, multiBamSummary, multiBigwigSummary, correctGCBias, alignmentSieve\r\n\r\nComplete reference: `references/tools_reference.md` → \"BAM and bigWig File Processing Tools\"\r\n\r\n### Quality Control\r\n\r\n**Check ChIP enrichment:**\r\n```bash\r\nplotFingerprint -b input.bam chip.bam -o fingerprint.png \\\r\n    --extendReads 200 --ignoreDuplicates\r\n```\r\n\r\n**Sample correlation:**\r\n```bash\r\nmultiBamSummary bins --bamfiles *.bam -o counts.npz\r\nplotCorrelation -in counts.npz --corMethod pearson \\\r\n    --whatToShow heatmap -o correlation.png\r\n```\r\n\r\n**Key tools:** plotFingerprint, plotCoverage, plotCorrelation, plotPCA, bamPEFragmentSize\r\n\r\nComplete reference: `references/tools_reference.md` → \"Quality Control Tools\"\r\n\r\n### Visualization\r\n\r\n**Create heatmap around TSS:**\r\n```bash\r\ncomputeMatrix reference-point -S signal.bw -R genes.bed \\\r\n    -b 3000 -a 3000 --referencePoint TSS -o matrix.gz\r\n\r\n\r\n### scripts/validate_files.py\r\n\r\nValidates BAM, bigWig, and BED files for deepTools analysis. Checks file existence, indices, and format.\r\n\r\n**Usage:**\r\n```bash\r\npython scripts/validate_files.py --bam sample1.bam sample2.bam \\\r\n    --bed peaks.bed --bigwig signal.bw\r\n```\r\n\r\n**When to use:** Before starting any analysis, or when troubleshooting errors.\r\n\r\n### scripts/workflow_generator.py\r\n\r\nGenerates customizable bash script templates for common deepTools workflows.\r\n\r\n**Available workflows:**\r\n- `chipseq_qc`: ChIP-seq quality control\r\n- `chipseq_analysis`: Complete ChIP-seq analysis\r\n- `rnaseq_coverage`: Strand-specific RNA-seq coverage\r\n- `atacseq`: ATAC-seq with Tn5 correction\r\n\r\n**Usage:**\r\n```bash\r\npython scripts/workflow_generator.py --list\r\n\r\npython scripts/workflow_generator.py chipseq_qc -o qc.sh \\\r\n    --input-bam Input.bam --chip-bams \"ChIP1.bam ChIP2.bam\" \\\r\n    --genome-size 2913022398 --threads 8\r\n\r\n\r\n### For New Users\r\n\r\n1. Start with installation verification\r\n2. Validate input files using `scripts/validate_files.py`\r\n3. Recommend appropriate workflow based on experiment type\r\n4. Generate workflow template using `scripts/workflow_generator.py`\r\n5. Guide through customization and execution\r\n\r\n### For Experienced Users\r\n\r\n1. Provide specific tool commands for requested operations\r\n2. Reference appropriate sections in `references/tools_reference.md`\r\n3. Suggest optimizations and best practices\r\n4. Offer troubleshooting for issues\r\n\r\n### For Specific Tasks\r\n\r\n**\"Convert BAM to bigWig\":**\r\n- Use bamCoverage with appropriate normalization\r\n- Recommend RPGC or CPM based on use case\r\n- Provide effective genome size for organism\r\n- Suggest relevant parameters (extendReads, ignoreDuplicates, binSize)\r\n\r\n**\"Check ChIP quality\":**\r\n- Run full QC workflow or use plotFingerprint specifically\r\n- Explain interpretation of results\r\n- Suggest follow-up actions based on results\r\n\r\n**\"Create heatmap\":**\r\n- Guide through two-step process: computeMatrix → plotHeatmap\r\n- Help choose appropriate matrix mode (reference-point vs scale-regions)\r\n- Suggest visualization parameters and clustering options\r\n\r\n**\"Compare samples\":**\r\n- Recommend bamCompare for two-sample comparison\r\n- Suggest multiBamSummary + plotCorrelation for multiple samples\r\n- Guide normalization method selection\r\n\r\n### Referencing Documentation\r\n\r\nWhen users need detailed information:\r\n- **Tool details**: Direct to specific sections in `references/tools_reference.md`\r\n- **Workflows**: Use `references/workflows.md` for complete analysis pipelines\r\n- **Normalization**: Consult `references/normalization_methods.md` for method selection\r\n- **Genome sizes**: Reference `references/effective_genome_sizes.md`\r\n\r\nSearch references using grep patterns:\r\n```bash\r\ngrep -A 20 \"^### toolname\" references/tools_reference.md\r\n\r\ngrep -A 50 \"^## Workflow Name\" references/workflows.md",
  "name": "deeptools",
  "id": "scientific-pkg-deeptools",
  "sections": {
    "Key Reminders": "- **File validation first**: Always validate input files before analysis\r\n- **Normalization matters**: Choose appropriate method for comparison type\r\n- **Extend reads carefully**: YES for ChIP-seq, NO for RNA-seq\r\n- **Use all cores**: Set `--numberOfProcessors` to available cores\r\n- **Test on regions**: Use `--region` for parameter testing\r\n- **Check QC first**: Run quality control before detailed analysis\r\n- **Document everything**: Save commands for reproducibility\r\n- **Reference documentation**: Use comprehensive references for detailed guidance",
    "Tool Categories and Common Tasks": "plotHeatmap -m matrix.gz -o heatmap.png \\\r\n    --colorMap RdBu --kmeans 3\r\n```\r\n\r\n**Create profile plot:**\r\n```bash\r\nplotProfile -m matrix.gz -o profile.png \\\r\n    --plotType lines --colors blue red\r\n```\r\n\r\n**Key tools:** computeMatrix, plotHeatmap, plotProfile, plotEnrichment\r\n\r\nComplete reference: `references/tools_reference.md` → \"Visualization Tools\"",
    "Overview": "deepTools is a comprehensive suite of Python command-line tools designed for processing and analyzing high-throughput sequencing data. Use deepTools to perform quality control, normalize data, compare samples, and generate publication-quality visualizations for ChIP-seq, RNA-seq, ATAC-seq, MNase-seq, and other NGS experiments.\r\n\r\n**Core capabilities:**\r\n- Convert BAM alignments to normalized coverage tracks (bigWig/bedGraph)\r\n- Quality control assessment (fingerprint, correlation, coverage)\r\n- Sample comparison and correlation analysis\r\n- Heatmap and profile plot generation around genomic features\r\n- Enrichment analysis and peak region visualization",
    "Installation": "CONDA_SUBDIR=osx-64 conda create -c conda-forge -c bioconda -n deeptools deeptools\r\n```\r\n\r\nOr using pip:\r\n\r\n```bash\r\npip install deeptools\r\n```",
    "Reference Documentation": "This skill includes comprehensive reference documentation:\r\n\r\n### references/tools_reference.md\r\nComplete documentation of all deepTools commands organized by category:\r\n- BAM and bigWig processing tools (9 tools)\r\n- Quality control tools (6 tools)\r\n- Visualization tools (3 tools)\r\n- Miscellaneous tools (2 tools)\r\n\r\nEach tool includes:\r\n- Purpose and overview\r\n- Key parameters with explanations\r\n- Usage examples\r\n- Important notes and best practices\r\n\r\n**Use this reference when:** Users ask about specific tools, parameters, or detailed usage.\r\n\r\n### references/workflows.md\r\nComplete workflow examples for common analyses:\r\n- ChIP-seq quality control workflow\r\n- ChIP-seq complete analysis workflow\r\n- RNA-seq coverage workflow\r\n- ATAC-seq analysis workflow\r\n- Multi-sample comparison workflow\r\n- Peak region analysis workflow\r\n- Troubleshooting and performance tips\r\n\r\n**Use this reference when:** Users need complete analysis pipelines or workflow examples.\r\n\r\n### references/normalization_methods.md\r\nComprehensive guide to normalization methods:\r\n- Detailed explanation of each method (RPGC, CPM, RPKM, BPM, etc.)\r\n- When to use each method\r\n- Formulas and interpretation\r\n- Selection guide by experiment type\r\n- Common pitfalls and solutions\r\n- Quick reference table\r\n\r\n**Use this reference when:** Users ask about normalization, comparing samples, or which method to use.\r\n\r\n### references/effective_genome_sizes.md\r\nEffective genome size values and usage:\r\n- Common organism values (human, mouse, fly, worm, zebrafish)\r\n- Read-length-specific values\r\n- Calculation methods\r\n- When and how to use in commands\r\n- Custom genome calculation instructions\r\n\r\n**Use this reference when:** Users need genome size for RPGC normalization or GC bias correction.",
    "Effective Genome Sizes": "RPGC normalization requires effective genome size. Common values:\r\n\r\n| Organism | Assembly | Size | Usage |\r\n|----------|----------|------|-------|\r\n| Human | GRCh38/hg38 | 2,913,022,398 | `--effectiveGenomeSize 2913022398` |\r\n| Mouse | GRCm38/mm10 | 2,652,783,500 | `--effectiveGenomeSize 2652783500` |\r\n| Zebrafish | GRCz11 | 1,368,780,147 | `--effectiveGenomeSize 1368780147` |\r\n| *Drosophila* | dm6 | 142,573,017 | `--effectiveGenomeSize 142573017` |\r\n| *C. elegans* | ce10/ce11 | 100,286,401 | `--effectiveGenomeSize 100286401` |\r\n\r\nComplete table with read-length-specific values: `references/effective_genome_sizes.md`",
    "Best Practices": "### File Validation\r\n**Always validate files first** using `scripts/validate_files.py` to check:\r\n- File existence and readability\r\n- BAM indices present (.bai files)\r\n- BED format correctness\r\n- File sizes reasonable\r\n\r\n### Analysis Strategy\r\n\r\n1. **Start with QC**: Run correlation, coverage, and fingerprint analysis before proceeding\r\n2. **Test on small regions**: Use `--region chr1:1-10000000` for parameter testing\r\n3. **Document commands**: Save full command lines for reproducibility\r\n4. **Use consistent normalization**: Apply same method across samples in comparisons\r\n5. **Verify genome assembly**: Ensure BAM and BED files use matching genome builds\r\n\r\n### ChIP-seq Specific\r\n\r\n- **Always extend reads** for ChIP-seq: `--extendReads 200`\r\n- **Remove duplicates**: Use `--ignoreDuplicates` in most cases\r\n- **Check enrichment first**: Run plotFingerprint before detailed analysis\r\n- **GC correction**: Only apply if significant bias detected; never use `--ignoreDuplicates` after GC correction\r\n\r\n### RNA-seq Specific\r\n\r\n- **Never extend reads** for RNA-seq (would span splice junctions)\r\n- **Strand-specific**: Use `--filterRNAstrand forward/reverse` for stranded libraries\r\n- **Normalization**: CPM for bins, RPKM for genes\r\n\r\n### ATAC-seq Specific\r\n\r\n- **Apply Tn5 correction**: Use alignmentSieve with `--ATACshift`\r\n- **Fragment filtering**: Set appropriate min/max fragment lengths\r\n- **Check nucleosome pattern**: Fragment size plot should show ladder pattern\r\n\r\n### Performance Optimization\r\n\r\n1. **Use multiple processors**: `--numberOfProcessors 8` (or available cores)\r\n2. **Increase bin size** for faster processing and smaller files\r\n3. **Process chromosomes separately** for memory-limited systems\r\n4. **Pre-filter BAM files** using alignmentSieve to create reusable filtered files\r\n5. **Use bigWig over bedGraph**: Compressed and faster to process",
    "Example Interactions": "**User: \"I need to analyze my ChIP-seq data\"**\r\n\r\nResponse approach:\r\n1. Ask about files available (BAM files, peaks, genes)\r\n2. Validate files using validation script\r\n3. Generate chipseq_analysis workflow template\r\n4. Customize for their specific files and organism\r\n5. Explain each step as script runs\r\n\r\n**User: \"Which normalization should I use?\"**\r\n\r\nResponse approach:\r\n1. Ask about experiment type (ChIP-seq, RNA-seq, etc.)\r\n2. Ask about comparison goal (within-sample or between-sample)\r\n3. Consult `references/normalization_methods.md` selection guide\r\n4. Recommend appropriate method with justification\r\n5. Provide command example with parameters\r\n\r\n**User: \"Create a heatmap around TSS\"**\r\n\r\nResponse approach:\r\n1. Verify bigWig and gene BED files available\r\n2. Use computeMatrix with reference-point mode at TSS\r\n3. Generate plotHeatmap with appropriate visualization parameters\r\n4. Suggest clustering if dataset is large\r\n5. Offer profile plot as complement",
    "When to Use This Skill": "This skill should be used when:\r\n\r\n- **File conversion**: \"Convert BAM to bigWig\", \"generate coverage tracks\", \"normalize ChIP-seq data\"\r\n- **Quality control**: \"check ChIP quality\", \"compare replicates\", \"assess sequencing depth\", \"QC analysis\"\r\n- **Visualization**: \"create heatmap around TSS\", \"plot ChIP signal\", \"visualize enrichment\", \"generate profile plot\"\r\n- **Sample comparison**: \"compare treatment vs control\", \"correlate samples\", \"PCA analysis\"\r\n- **Analysis workflows**: \"analyze ChIP-seq data\", \"RNA-seq coverage\", \"ATAC-seq analysis\", \"complete workflow\"\r\n- **Working with specific file types**: BAM files, bigWig files, BED region files in genomics context",
    "Normalization Methods": "Choosing the correct normalization is critical for valid comparisons. Consult `references/normalization_methods.md` for comprehensive guidance.\r\n\r\n**Quick selection guide:**\r\n\r\n- **ChIP-seq coverage**: Use RPGC or CPM\r\n- **ChIP-seq comparison**: Use bamCompare with log2 and readCount\r\n- **RNA-seq bins**: Use CPM\r\n- **RNA-seq genes**: Use RPKM (accounts for gene length)\r\n- **ATAC-seq**: Use RPGC or CPM\r\n\r\n**Normalization methods:**\r\n- **RPGC**: 1× genome coverage (requires --effectiveGenomeSize)\r\n- **CPM**: Counts per million mapped reads\r\n- **RPKM**: Reads per kb per million (accounts for region length)\r\n- **BPM**: Bins per million\r\n- **None**: Raw counts (not recommended for comparisons)\r\n\r\nFull explanation: `references/normalization_methods.md`",
    "Common Parameters Across Tools": "Many deepTools commands share these options:\r\n\r\n**Performance:**\r\n- `--numberOfProcessors, -p`: Enable parallel processing (always use available cores)\r\n- `--region`: Process specific regions for testing (e.g., `chr1:1-1000000`)\r\n\r\n**Read Filtering:**\r\n- `--ignoreDuplicates`: Remove PCR duplicates (recommended for most analyses)\r\n- `--minMappingQuality`: Filter by alignment quality (e.g., `--minMappingQuality 10`)\r\n- `--minFragmentLength` / `--maxFragmentLength`: Fragment length bounds\r\n- `--samFlagInclude` / `--samFlagExclude`: SAM flag filtering\r\n\r\n**Read Processing:**\r\n- `--extendReads`: Extend to fragment length (ChIP-seq: YES, RNA-seq: NO)\r\n- `--centerReads`: Center at fragment midpoint for sharper signals",
    "Helper Scripts": "chmod +x qc.sh\r\n./qc.sh\r\n```\r\n\r\n**When to use:** Users request standard workflows or need template scripts to customize.",
    "Core Workflows": "deepTools workflows typically follow this pattern: **QC → Normalization → Comparison/Visualization**\r\n\r\n### ChIP-seq Quality Control Workflow\r\n\r\nWhen users request ChIP-seq QC or quality assessment:\r\n\r\n1. **Generate workflow script** using `scripts/workflow_generator.py chipseq_qc`\r\n2. **Key QC steps**:\r\n   - Sample correlation (multiBamSummary + plotCorrelation)\r\n   - PCA analysis (plotPCA)\r\n   - Coverage assessment (plotCoverage)\r\n   - Fragment size validation (bamPEFragmentSize)\r\n   - ChIP enrichment strength (plotFingerprint)\r\n\r\n**Interpreting results:**\r\n- **Correlation**: Replicates should cluster together with high correlation (>0.9)\r\n- **Fingerprint**: Strong ChIP shows steep rise; flat diagonal indicates poor enrichment\r\n- **Coverage**: Assess if sequencing depth is adequate for analysis\r\n\r\nFull workflow details in `references/workflows.md` → \"ChIP-seq Quality Control Workflow\"\r\n\r\n### ChIP-seq Complete Analysis Workflow\r\n\r\nFor full ChIP-seq analysis from BAM to visualizations:\r\n\r\n1. **Generate coverage tracks** with normalization (bamCoverage)\r\n2. **Create comparison tracks** (bamCompare for log2 ratio)\r\n3. **Compute signal matrices** around features (computeMatrix)\r\n4. **Generate visualizations** (plotHeatmap, plotProfile)\r\n5. **Enrichment analysis** at peaks (plotEnrichment)\r\n\r\nUse `scripts/workflow_generator.py chipseq_analysis` to generate template.\r\n\r\nComplete command sequences in `references/workflows.md` → \"ChIP-seq Analysis Workflow\"\r\n\r\n### RNA-seq Coverage Workflow\r\n\r\nFor strand-specific RNA-seq coverage tracks:\r\n\r\nUse bamCoverage with `--filterRNAstrand` to separate forward and reverse strands.\r\n\r\n**Important:** NEVER use `--extendReads` for RNA-seq (would extend over splice junctions).\r\n\r\nUse normalization: CPM for fixed bins, RPKM for gene-level analysis.\r\n\r\nTemplate available: `scripts/workflow_generator.py rnaseq_coverage`\r\n\r\nDetails in `references/workflows.md` → \"RNA-seq Coverage Workflow\"\r\n\r\n### ATAC-seq Analysis Workflow\r\n\r\nATAC-seq requires Tn5 offset correction:\r\n\r\n1. **Shift reads** using alignmentSieve with `--ATACshift`\r\n2. **Generate coverage** with bamCoverage\r\n3. **Analyze fragment sizes** (expect nucleosome ladder pattern)\r\n4. **Visualize at peaks** if available\r\n\r\nTemplate: `scripts/workflow_generator.py atacseq`\r\n\r\nFull workflow in `references/workflows.md` → \"ATAC-seq Workflow\"",
    "Troubleshooting": "### Common Issues\r\n\r\n**BAM index missing:**\r\n```bash\r\nsamtools index input.bam\r\n```\r\n\r\n**Out of memory:**\r\nProcess chromosomes individually using `--region`:\r\n```bash\r\nbamCoverage --bam input.bam -o chr1.bw --region chr1\r\n```\r\n\r\n**Slow processing:**\r\nIncrease `--numberOfProcessors` and/or increase `--binSize`\r\n\r\n**bigWig files too large:**\r\nIncrease bin size: `--binSize 50` or larger\r\n\r\n### Validation Errors\r\n\r\nRun validation script to identify issues:\r\n```bash\r\npython scripts/validate_files.py --bam *.bam --bed regions.bed\r\n```\r\n\r\nCommon errors and solutions explained in script output.",
    "Handling User Requests": "grep -A 15 \"^### Method Name\" references/normalization_methods.md\r\n```",
    "Assets": "### assets/quick_reference.md\r\n\r\nQuick reference card with most common commands, effective genome sizes, and typical workflow pattern.\r\n\r\n**When to use:** Users need quick command examples without detailed documentation.",
    "Quick Start": "chmod +x qc_workflow.sh\r\n./qc_workflow.sh\r\n```\r\n\r\n### 3. Most Common Operations\r\n\r\nSee `assets/quick_reference.md` for frequently used commands and parameters."
  }
}
{
  "description": "\"Diffusion-based molecular docking. Predict protein-ligand binding poses from PDB/SMILES, confidence scores, virtual screening, for structure-based drug design. Not for affinity prediction.\"",
  "references": {
    "files": [
      "references/confidence_and_limitations.md",
      "references/parameters_reference.md",
      "references/workflows_examples.md"
    ]
  },
  "content": "### Check Environment Status\r\n\r\nBefore proceeding with DiffDock tasks, verify the environment setup:\r\n\r\n```bash\r\n\r\n### Workflow 1: Single Protein-Ligand Docking\r\n\r\n**Use Case:** Dock one ligand to one protein target\r\n\r\n**Input Requirements:**\r\n- Protein: PDB file OR amino acid sequence\r\n- Ligand: SMILES string OR structure file (SDF/MOL2)\r\n\r\n**Command:**\r\n```bash\r\npython -m inference \\\r\n  --config default_inference_args.yaml \\\r\n  --protein_path protein.pdb \\\r\n  --ligand \"CC(=O)Oc1ccccc1C(=O)O\" \\\r\n  --out_dir results/single_docking/\r\n```\r\n\r\n**Alternative (protein sequence):**\r\n```bash\r\npython -m inference \\\r\n  --config default_inference_args.yaml \\\r\n  --protein_sequence \"MSKGEELFTGVVPILVELDGDVNGHKF...\" \\\r\n  --ligand ligand.sdf \\\r\n  --out_dir results/sequence_docking/\r\n```\r\n\r\n**Output Structure:**\r\n```\r\nresults/single_docking/\r\n├── rank_1.sdf          # Top-ranked pose\r\n├── rank_2.sdf          # Second-ranked pose\r\n├── ...\r\n├── rank_10.sdf         # 10th pose (default: 10 samples)\r\n└── confidence_scores.txt\r\n```\r\n\r\n### Workflow 2: Batch Processing Multiple Complexes\r\n\r\n**Use Case:** Dock multiple ligands to proteins, virtual screening campaigns\r\n\r\n**Step 1: Prepare Batch CSV**\r\n\r\nUse the provided script to create or validate batch input:\r\n\r\n```bash\r\npython scripts/prepare_batch_csv.py --create --output batch_input.csv\r\n\r\npython scripts/prepare_batch_csv.py my_input.csv --validate\r\n```\r\n\r\n**CSV Format:**\r\n```csv\r\ncomplex_name,protein_path,ligand_description,protein_sequence\r\ncomplex1,protein1.pdb,CC(=O)Oc1ccccc1C(=O)O,\r\ncomplex2,,COc1ccc(C#N)cc1,MSKGEELFT...\r\ncomplex3,protein3.pdb,ligand3.sdf,\r\n```\r\n\r\n**Required Columns:**\r\n- `complex_name`: Unique identifier\r\n- `protein_path`: PDB file path (leave empty if using sequence)\r\n- `ligand_description`: SMILES string or ligand file path\r\n- `protein_sequence`: Amino acid sequence (leave empty if using PDB)\r\n\r\n**Step 2: Run Batch Docking**\r\n\r\n```bash\r\npython -m inference \\\r\n  --config default_inference_args.yaml \\\r\n  --protein_ligand_csv batch_input.csv \\\r\n  --out_dir results/batch/ \\\r\n  --batch_size 10\r\n```\r\n\r\n**For Large Virtual Screening (>100 compounds):**\r\n\r\nPre-compute protein embeddings for faster processing:\r\n```bash\r\npython datasets/esm_embedding_preparation.py \\\r\n  --protein_ligand_csv screening_input.csv \\\r\n  --out_file protein_embeddings.pt\r\n\r\npython -m inference \\\r\n  --config default_inference_args.yaml \\\r\n  --protein_ligand_csv screening_input.csv \\\r\n  --esm_embeddings_path protein_embeddings.pt \\\r\n  --out_dir results/screening/\r\n```\r\n\r\n### Workflow 3: Analyzing Results\r\n\r\nAfter docking completes, analyze confidence scores and rank predictions:\r\n\r\n```bash\r\npython scripts/analyze_results.py results/batch/\r\n\r\npython scripts/analyze_results.py results/batch/ --top 5\r\n\r\npython scripts/analyze_results.py results/batch/ --threshold 0.0\r\n\r\npython scripts/analyze_results.py results/batch/ --export summary.csv\r\n\r\n\r\n### Using Custom Configuration\r\n\r\nCreate custom configuration for specific use cases:\r\n\r\n```bash\r\ncp assets/custom_inference_config.yaml my_config.yaml\r\n\r\n\r\n### Ensemble Docking (Protein Flexibility)\r\n\r\nFor proteins with known flexibility, dock to multiple conformations:\r\n\r\n```python\r\n\r\nFor interactive use, launch the web interface:\r\n\r\n```bash\r\npython app/main.py",
  "name": "diffdock",
  "id": "scientific-pkg-diffdock",
  "sections": {
    "Limitations and Scope": "**DiffDock IS Designed For:**\r\n- Small molecule ligands (typically 100-1000 Da)\r\n- Drug-like organic compounds\r\n- Small peptides (<20 residues)\r\n- Single or multi-chain proteins\r\n\r\n**DiffDock IS NOT Designed For:**\r\n- Large biomolecules (protein-protein docking) → Use DiffDock-PP or AlphaFold-Multimer\r\n- Large peptides (>20 residues) → Use alternative methods\r\n- Covalent docking → Use specialized covalent docking tools\r\n- Binding affinity prediction → Combine with scoring functions\r\n- Membrane proteins → Not specifically trained, use with caution\r\n\r\n**For complete limitations:** Read `references/confidence_and_limitations.md` using the Read tool",
    "Installation and Environment Setup": "python scripts/setup_check.py\r\n```\r\n\r\nThis script validates Python version, PyTorch with CUDA, PyTorch Geometric, RDKit, ESM, and other dependencies.\r\n\r\n### Installation Options\r\n\r\n**Option 1: Conda (Recommended)**\r\n```bash\r\ngit clone https://github.com/gcorso/DiffDock.git\r\ncd DiffDock\r\nconda env create --file environment.yml\r\nconda activate diffdock\r\n```\r\n\r\n**Option 2: Docker**\r\n```bash\r\ndocker pull rbgcsail/diffdock\r\ndocker run -it --gpus all --entrypoint /bin/bash rbgcsail/diffdock\r\nmicromamba activate diffdock\r\n```\r\n\r\n**Important Notes:**\r\n- GPU strongly recommended (10-100x speedup vs CPU)\r\n- First run pre-computes SO(2)/SO(3) lookup tables (~2-5 minutes)\r\n- Model checkpoints (~500MB) download automatically if not present",
    "Graphical User Interface": "```\r\n\r\nOr use the online demo without installation:\r\n- https://huggingface.co/spaces/reginabarzilaygroup/DiffDock-Web",
    "Citations": "When using DiffDock, cite the appropriate papers:\r\n\r\n**DiffDock-L (current default model):**\r\n```\r\nStärk et al. (2024) \"DiffDock-L: Improving Molecular Docking with Diffusion Models\"\r\narXiv:2402.18396\r\n```\r\n\r\n**Original DiffDock:**\r\n```\r\nCorso et al. (2023) \"DiffDock: Diffusion Steps, Twists, and Turns for Molecular Docking\"\r\nICLR 2023, arXiv:2210.01776\r\n```",
    "Overview": "DiffDock is a diffusion-based deep learning tool for molecular docking that predicts 3D binding poses of small molecule ligands to protein targets. It represents the state-of-the-art in computational docking, crucial for structure-based drug discovery and chemical biology.\r\n\r\n**Core Capabilities:**\r\n- Predict ligand binding poses with high accuracy using deep learning\r\n- Support protein structures (PDB files) or sequences (via ESMFold)\r\n- Process single complexes or batch virtual screening campaigns\r\n- Generate confidence scores to assess prediction reliability\r\n- Handle diverse ligand inputs (SMILES, SDF, MOL2)\r\n\r\n**Key Distinction:** DiffDock predicts **binding poses** (3D structure) and **confidence** (prediction certainty), NOT binding affinity (ΔG, Kd). Always combine with scoring functions (GNINA, MM/GBSA) for affinity assessment.",
    "Advanced Techniques": "import pandas as pd\r\n\r\nconformations = [\"conf1.pdb\", \"conf2.pdb\", \"conf3.pdb\"]\r\nligand = \"CC(=O)Oc1ccccc1C(=O)O\"\r\n\r\ndata = {\r\n    \"complex_name\": [f\"ensemble_{i}\" for i in range(len(conformations))],\r\n    \"protein_path\": conformations,\r\n    \"ligand_description\": [ligand] * len(conformations),\r\n    \"protein_sequence\": [\"\"] * len(conformations)\r\n}\r\n\r\npd.DataFrame(data).to_csv(\"ensemble_input.csv\", index=False)\r\n```\r\n\r\nRun docking with increased sampling:\r\n```bash\r\npython -m inference \\\r\n  --config default_inference_args.yaml \\\r\n  --protein_ligand_csv ensemble_input.csv \\\r\n  --samples_per_complex 20 \\\r\n  --out_dir results/ensemble/\r\n```\r\n\r\n### Integration with Scoring Functions\r\n\r\nDiffDock generates poses; combine with other tools for affinity:\r\n\r\n**GNINA (Fast neural network scoring):**\r\n```bash\r\nfor pose in results/*.sdf; do\r\n    gnina -r protein.pdb -l \"$pose\" --score_only\r\ndone\r\n```\r\n\r\n**MM/GBSA (More accurate, slower):**\r\nUse AmberTools MMPBSA.py or gmx_MMPBSA after energy minimization\r\n\r\n**Free Energy Calculations (Most accurate):**\r\nUse OpenMM + OpenFE or GROMACS for FEP/TI calculations\r\n\r\n**Recommended Workflow:**\r\n1. DiffDock → Generate poses with confidence scores\r\n2. Visual inspection → Check structural plausibility\r\n3. GNINA or MM/GBSA → Rescore and rank by affinity\r\n4. Experimental validation → Biochemical assays",
    "Confidence Score Interpretation": "**Understanding Scores:**\r\n\r\n| Score Range | Confidence Level | Interpretation |\r\n|------------|------------------|----------------|\r\n| **> 0** | High | Strong prediction, likely accurate |\r\n| **-1.5 to 0** | Moderate | Reasonable prediction, validate carefully |\r\n| **< -1.5** | Low | Uncertain prediction, requires validation |\r\n\r\n**Critical Notes:**\r\n1. **Confidence ≠ Affinity**: High confidence means model certainty about structure, NOT strong binding\r\n2. **Context Matters**: Adjust expectations for:\r\n   - Large ligands (>500 Da): Lower confidence expected\r\n   - Multiple protein chains: May decrease confidence\r\n   - Novel protein families: May underperform\r\n3. **Multiple Samples**: Review top 3-5 predictions, look for consensus\r\n\r\n**For detailed guidance:** Read `references/confidence_and_limitations.md` using the Read tool",
    "Best Practices": "1. **Always verify environment** with `setup_check.py` before starting large jobs\r\n2. **Validate batch CSVs** with `prepare_batch_csv.py` to catch errors early\r\n3. **Start with defaults** then tune parameters based on system-specific needs\r\n4. **Generate multiple samples** (10-40) for robust predictions\r\n5. **Visual inspection** of top poses before downstream analysis\r\n6. **Combine with scoring** functions for affinity assessment\r\n7. **Use confidence scores** for initial ranking, not final decisions\r\n8. **Pre-compute embeddings** for virtual screening campaigns\r\n9. **Document parameters** used for reproducibility\r\n10. **Validate results** experimentally when possible",
    "When to Use This Skill": "This skill should be used when:\r\n\r\n- \"Dock this ligand to a protein\" or \"predict binding pose\"\r\n- \"Run molecular docking\" or \"perform protein-ligand docking\"\r\n- \"Virtual screening\" or \"screen compound library\"\r\n- \"Where does this molecule bind?\" or \"predict binding site\"\r\n- Structure-based drug design or lead optimization tasks\r\n- Tasks involving PDB files + SMILES strings or ligand structures\r\n- Batch docking of multiple protein-ligand pairs",
    "Resources": "### Helper Scripts (`scripts/`)\r\n\r\n**`prepare_batch_csv.py`**: Create and validate batch input CSV files\r\n- Create templates with example entries\r\n- Validate file paths and SMILES strings\r\n- Check for required columns and format issues\r\n\r\n**`analyze_results.py`**: Analyze confidence scores and rank predictions\r\n- Parse results from single or batch runs\r\n- Generate statistical summaries\r\n- Export to CSV for downstream analysis\r\n- Identify top predictions across complexes\r\n\r\n**`setup_check.py`**: Verify DiffDock environment setup\r\n- Check Python version and dependencies\r\n- Verify PyTorch and CUDA availability\r\n- Test RDKit and PyTorch Geometric installation\r\n- Provide installation instructions if needed\r\n\r\n### Reference Documentation (`references/`)\r\n\r\n**`parameters_reference.md`**: Complete parameter documentation\r\n- All command-line options and configuration parameters\r\n- Default values and acceptable ranges\r\n- Temperature parameters for controlling diversity\r\n- Model checkpoint locations and version flags\r\n\r\nRead this file when users need:\r\n- Detailed parameter explanations\r\n- Fine-tuning guidance for specific systems\r\n- Alternative sampling strategies\r\n\r\n**`confidence_and_limitations.md`**: Confidence score interpretation and tool limitations\r\n- Detailed confidence score interpretation\r\n- When to trust predictions\r\n- Scope and limitations of DiffDock\r\n- Integration with complementary tools\r\n- Troubleshooting prediction quality\r\n\r\nRead this file when users need:\r\n- Help interpreting confidence scores\r\n- Understanding when NOT to use DiffDock\r\n- Guidance on combining with other tools\r\n- Validation strategies\r\n\r\n**`workflows_examples.md`**: Comprehensive workflow examples\r\n- Detailed installation instructions\r\n- Step-by-step examples for all workflows\r\n- Advanced integration patterns\r\n- Troubleshooting common issues\r\n- Best practices and optimization tips\r\n\r\nRead this file when users need:\r\n- Complete workflow examples with code\r\n- Integration with GNINA, OpenMM, or other tools\r\n- Virtual screening workflows\r\n- Ensemble docking procedures\r\n\r\n### Assets (`assets/`)\r\n\r\n**`batch_template.csv`**: Template for batch processing\r\n- Pre-formatted CSV with required columns\r\n- Example entries showing different input types\r\n- Ready to customize with actual data\r\n\r\n**`custom_inference_config.yaml`**: Configuration template\r\n- Annotated YAML with all parameters\r\n- Four preset configurations for common use cases\r\n- Detailed comments explaining each parameter\r\n- Ready to customize and use",
    "Core Workflows": "python scripts/analyze_results.py results/batch/ --best 20\r\n```\r\n\r\nThe analysis script:\r\n- Parses confidence scores from all predictions\r\n- Classifies as High (>0), Moderate (-1.5 to 0), or Low (<-1.5)\r\n- Ranks predictions within and across complexes\r\n- Generates statistical summaries\r\n- Exports results to CSV for downstream analysis",
    "Troubleshooting": "### Common Issues\r\n\r\n**Issue: Low confidence scores across all predictions**\r\n- Cause: Large/unusual ligands, unclear binding site, protein flexibility\r\n- Solution: Increase `samples_per_complex` (20-40), try ensemble docking, validate protein structure\r\n\r\n**Issue: Out of memory errors**\r\n- Cause: GPU memory insufficient for batch size\r\n- Solution: Reduce `--batch_size 2` or process fewer complexes at once\r\n\r\n**Issue: Slow performance**\r\n- Cause: Running on CPU instead of GPU\r\n- Solution: Verify CUDA with `python -c \"import torch; print(torch.cuda.is_available())\"`, use GPU\r\n\r\n**Issue: Unrealistic binding poses**\r\n- Cause: Poor protein preparation, ligand too large, wrong binding site\r\n- Solution: Check protein for missing residues, remove far waters, consider specifying binding site\r\n\r\n**Issue: \"Module not found\" errors**\r\n- Cause: Missing dependencies or wrong environment\r\n- Solution: Run `python scripts/setup_check.py` to diagnose\r\n\r\n### Performance Optimization\r\n\r\n**For Best Results:**\r\n1. Use GPU (essential for practical use)\r\n2. Pre-compute ESM embeddings for repeated protein use\r\n3. Batch process multiple complexes together\r\n4. Start with default parameters, then tune if needed\r\n5. Validate protein structures (resolve missing residues)\r\n6. Use canonical SMILES for ligands",
    "Parameter Customization": "python -m inference \\\r\n  --config my_config.yaml \\\r\n  --protein_ligand_csv input.csv \\\r\n  --out_dir results/\r\n```\r\n\r\n### Key Parameters to Adjust\r\n\r\n**Sampling Density:**\r\n- `samples_per_complex: 10` → Increase to 20-40 for difficult cases\r\n- More samples = better coverage but longer runtime\r\n\r\n**Inference Steps:**\r\n- `inference_steps: 20` → Increase to 25-30 for higher accuracy\r\n- More steps = potentially better quality but slower\r\n\r\n**Temperature Parameters (control diversity):**\r\n- `temp_sampling_tor: 7.04` → Increase for flexible ligands (8-10)\r\n- `temp_sampling_tor: 7.04` → Decrease for rigid ligands (5-6)\r\n- Higher temperature = more diverse poses\r\n\r\n**Presets Available in Template:**\r\n1. High Accuracy: More samples + steps, lower temperature\r\n2. Fast Screening: Fewer samples, faster\r\n3. Flexible Ligands: Increased torsion temperature\r\n4. Rigid Ligands: Decreased torsion temperature\r\n\r\n**For complete parameter reference:** Read `references/parameters_reference.md` using the Read tool",
    "Additional Resources": "- **GitHub Repository**: https://github.com/gcorso/DiffDock\r\n- **Online Demo**: https://huggingface.co/spaces/reginabarzilaygroup/DiffDock-Web\r\n- **DiffDock-L Paper**: https://arxiv.org/abs/2402.18396\r\n- **Original Paper**: https://arxiv.org/abs/2210.01776"
  }
}